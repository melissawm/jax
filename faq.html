
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Frequently asked questions (FAQ) &#8212; JAX  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/style.css?v=7143c0a5" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=30646c52"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'faq';</script>
    <link rel="icon" href="_static/favicon.png"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Change log" href="changelog.html" />
    <link rel="prev" title="About the project" href="about.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/jax_logo_250px.png" class="logo__image only-light" alt="JAX  documentation - Home"/>
    <script>document.write(`<img src="_static/jax_logo_250px.png" class="logo__image only-dark" alt="JAX  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/thinking_in_jax.html">Quickstart: How to think in JAX</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="notebooks/Common_Gotchas_in_JAX.html">üî™ JAX - The Sharp Bits üî™</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorials.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="jit-compilation.html">Just-in-time compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="automatic-vectorization.html">Automatic vectorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="automatic-differentiation.html">Automatic differentiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="random-numbers.html">Pseudorandom numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="stateful-computations.html">Stateful computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="control-flow.html">Control flow and logical operators with JIT</a></li>
<li class="toctree-l2"><a class="reference internal" href="pytrees.html">Pytrees</a></li>
<li class="toctree-l2"><a class="reference internal" href="working-with-pytrees.html">Working with pytrees</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources, guides, and references</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="key-concepts.html">Key concepts</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="advanced_guides.html">Resources and Advanced Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="notebooks/autodiff_cookbook.html">The Autodiff Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/Custom_derivative_rules_for_Python_code.html">Custom derivative rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/autodiff_remat.html">Control autodiff‚Äôs saved values with <code class="docutils literal notranslate"><span class="pre">jax.checkpoint</span></code> (aka <code class="docutils literal notranslate"><span class="pre">jax.remat</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced-autodiff.html">Advanced automatic differentiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Errors</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="debugging.html">Introduction to debugging</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="debugging/print_breakpoint.html">Compiled prints and breakpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/checkify_guide.html">The <code class="docutils literal notranslate"><span class="pre">checkify</span></code> transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/flags.html">JAX debugging flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="debugging/flags.html">JAX debugging flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="transfer_guard.html">Transfer guard</a></li>
<li class="toctree-l2"><a class="reference internal" href="persistent_compilation_cache.html">Persistent compilation cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu_performance_tips.html">GPU performance tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html">Profiling computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_memory_profiling.html">Profiling device memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/Distributed_arrays_and_automatic_parallelization.html">Distributed arrays and automatic parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/explicit-sharding.html">Explicit sharding (a.k.a. ‚Äúsharding in types‚Äù)</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/shard_map.html">Manual parallelism with <code class="docutils literal notranslate"><span class="pre">shard_map</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/layout.html">Device-local array layout control</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/host-offloading.html">JAX Memories and Host Offloading</a></li>

<li class="toctree-l2"><a class="reference internal" href="multi_process.html">Introduction to multi-controller JAX (aka multi-process/multi-host JAX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributed_data_loading.html">Distributed data loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-callbacks.html">External callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="ffi.html">Foreign function interface (FFI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gradient-checkpointing.html">Gradient checkpointing with <code class="docutils literal notranslate"><span class="pre">jax.checkpoint</span></code> (<code class="docutils literal notranslate"><span class="pre">jax.remat</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="aot.html">Ahead-of-time lowering and compilation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="export/index.html">Exporting and serialization</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="export/export.html">Exporting and serializing staged-out computations</a></li>
<li class="toctree-l3"><a class="reference internal" href="export/shape_poly.html">Shape polymorphism</a></li>
<li class="toctree-l3"><a class="reference internal" href="export/jax2tf.html">Interoperation with TensorFlow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="type_promotion.html">Type promotion semantics</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="pallas/index.html">Pallas: a JAX kernel language</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="pallas/quickstart.html">Pallas Quickstart</a></li>
<li class="toctree-l3"><a class="reference internal" href="pallas/pipelining.html">Software Pipelining</a></li>
<li class="toctree-l3"><a class="reference internal" href="pallas/grid_blockspec.html">Grids and BlockSpecs</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="pallas/tpu/index.html">Pallas TPU</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="pallas/tpu/details.html">Writing TPU kernels with Pallas</a></li>
<li class="toctree-l4"><a class="reference internal" href="pallas/tpu/pipelining.html">TPU Pipelining</a></li>
<li class="toctree-l4"><a class="reference internal" href="pallas/tpu/matmul.html">Matrix Multiplication</a></li>
<li class="toctree-l4"><a class="reference internal" href="pallas/tpu/sparse.html">Scalar Prefetch and Block-Sparse Computation</a></li>
<li class="toctree-l4"><a class="reference internal" href="pallas/tpu/distributed.html">Distributed Computing in Pallas for TPUs</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="pallas/gpu/index.html">Pallas:Mosaic GPU</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="pallas/gpu/reference.html">Writing Mosaic GPU kernels with Pallas</a></li>
<li class="toctree-l4"><a class="reference internal" href="pallas/gpu/pipelining.html">Mosaic GPU Pipelining</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="pallas/design/index.html">Pallas Design Notes</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="pallas/design/design.html">Pallas Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="pallas/design/async_note.html">Pallas Async Operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pallas/CHANGELOG.html">Pallas Changelog</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/neural_network_with_tfds_data.html">Training a simple neural network, with tensorflow/datasets data loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/Neural_Network_and_Data_Loading.html">Training a simple neural network, with PyTorch data loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/vmapped_log_probs.html">Autobatching for Bayesian inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/convolutions.html">Generalized convolutions in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="xla_flags.html">XLA compiler flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharded-computation.html">Introduction to parallel programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax-primitives.html">JAX Internals: primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="jaxpr.html">JAX internals: The jaxpr language</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="contributor_guide.html">Developer notes</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing to JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer.html">Building from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="investigating_a_regression.html">Investigating a regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="autodidax.html">Autodidax: JAX core from scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="autodidax2_part1.html">Autodidax2, part 1: JAX from scratch, again</a></li>

<li class="toctree-l2 has-children"><a class="reference internal" href="jep/index.html">JAX Enhancement Proposals (JEPs)</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jep/263-prng.html">263: JAX PRNG Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/2026-custom-derivatives.html">2026: Custom JVP/VJP rules for JAX-transformable functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/4008-custom-vjp-update.html">4008: Custom VJP and `nondiff_argnums` update</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/4410-omnistaging.html">4410: Omnistaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/9263-typed-keys.html">9263: Typed keys &amp; pluggable RNGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/9407-type-promotion.html">9407: Design of Type Promotion Semantics for JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/9419-jax-versioning.html">9419: Jax and Jaxlib versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/10657-sequencing-effects.html">10657: Sequencing side-effects in JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/11830-new-remat-checkpoint.html">11830: `jax.remat` / `jax.checkpoint` new implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/12049-type-annotations.html">12049: Type Annotation Roadmap for JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/14273-shard-map.html">14273: `shard_map` (`shmap`) for simple per-device code</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/15856-jex.html">15856: `jax.extend`, an extensions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/17111-shmap-transpose.html">17111: Efficient transposition of `shard_map` (and other maps)</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/18137-numpy-scipy-scope.html">18137: Scope of JAX NumPy &amp; SciPy Wrappers</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/25516-effver.html">25516: Effort-based versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="jep/28661-jax-array-protocol.html">28661: Supporting the `__jax_array__` protocol</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="extensions.html">Extension guides</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="notebooks/Writing_custom_interpreters_in_Jax.html">Writing custom Jaxpr interpreters in JAX</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.extend.html"><code class="docutils literal notranslate"><span class="pre">jax.extend</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.core.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.core</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.linear_util.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.linear_util</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.mlir.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.mlir</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.random.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.random</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="building_on_jax.html">Building on JAX</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="notes.html">Notes</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api_compatibility.html">API compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="deprecation.html">Python and NumPy version support policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="async_dispatch.html">Asynchronous dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrency.html">Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu_memory_allocation.html">GPU memory allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rank_promotion_warning.html">Rank promotion warning</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_promotion.html">Type promotion semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="default_dtypes.html">Default dtypes and the X64 flag</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="jax.html">Public API: <code class="docutils literal notranslate"><span class="pre">jax</span></code> package</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.numpy.html"><code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fft.html">jax.numpy.fft.fft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fft2.html">jax.numpy.fft.fft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fftfreq.html">jax.numpy.fft.fftfreq</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fftn.html">jax.numpy.fft.fftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.fftshift.html">jax.numpy.fft.fftshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.hfft.html">jax.numpy.fft.hfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ifft.html">jax.numpy.fft.ifft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ifft2.html">jax.numpy.fft.ifft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ifftn.html">jax.numpy.fft.ifftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ifftshift.html">jax.numpy.fft.ifftshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.ihfft.html">jax.numpy.fft.ihfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.irfft.html">jax.numpy.fft.irfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.irfft2.html">jax.numpy.fft.irfft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.irfftn.html">jax.numpy.fft.irfftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.rfft.html">jax.numpy.fft.rfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.rfft2.html">jax.numpy.fft.rfft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.rfftfreq.html">jax.numpy.fft.rfftfreq</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.numpy.fft.rfftn.html">jax.numpy.fft.rfftn</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.scipy.html"><code class="docutils literal notranslate"><span class="pre">jax.scipy</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.scipy.stats.bernoulli.logpmf.html">jax.scipy.stats.bernoulli.logpmf</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.scipy.stats.bernoulli.pmf.html">jax.scipy.stats.bernoulli.pmf</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.scipy.stats.bernoulli.cdf.html">jax.scipy.stats.bernoulli.cdf</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/jax.scipy.stats.bernoulli.ppf.html">jax.scipy.stats.bernoulli.ppf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jax.lax.html"><code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.random.html"><code class="docutils literal notranslate"><span class="pre">jax.random</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.sharding.html"><code class="docutils literal notranslate"><span class="pre">jax.sharding</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.debug.html"><code class="docutils literal notranslate"><span class="pre">jax.debug</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.dlpack.html"><code class="docutils literal notranslate"><span class="pre">jax.dlpack</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.distributed.html"><code class="docutils literal notranslate"><span class="pre">jax.distributed</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.dtypes.html"><code class="docutils literal notranslate"><span class="pre">jax.dtypes</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.ffi.html"><code class="docutils literal notranslate"><span class="pre">jax.ffi</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.flatten_util.html"><code class="docutils literal notranslate"><span class="pre">jax.flatten_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.image.html"><code class="docutils literal notranslate"><span class="pre">jax.image</span></code> module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.nn.html"><code class="docutils literal notranslate"><span class="pre">jax.nn</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jax.nn.initializers.html"><code class="docutils literal notranslate"><span class="pre">jax.nn.initializers</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jax.ops.html"><code class="docutils literal notranslate"><span class="pre">jax.ops</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.profiler.html"><code class="docutils literal notranslate"><span class="pre">jax.profiler</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.stages.html"><code class="docutils literal notranslate"><span class="pre">jax.stages</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.test_util.html"><code class="docutils literal notranslate"><span class="pre">jax.test_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.tree.html"><code class="docutils literal notranslate"><span class="pre">jax.tree</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.tree_util.html"><code class="docutils literal notranslate"><span class="pre">jax.tree_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.typing.html"><code class="docutils literal notranslate"><span class="pre">jax.typing</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="jax.export.html"><code class="docutils literal notranslate"><span class="pre">jax.export</span></code> module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.extend.html"><code class="docutils literal notranslate"><span class="pre">jax.extend</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.core.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.core</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.linear_util.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.linear_util</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.mlir.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.mlir</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.extend.random.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.random</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.example_libraries.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jax.example_libraries.optimizers.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries.optimizers</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.example_libraries.stax.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries.stax</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="jax.experimental.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.checkify.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.checkify</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.compilation_cache.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.compilation_cache</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.custom_dce.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.custom_dce</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.custom_partitioning.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.custom_partitioning</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.jet.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.jet</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.key_reuse.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.key_reuse</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.mesh_utils.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.mesh_utils</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.multihost_utils.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.multihost_utils</span></code> module</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="jax.experimental.pallas.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pallas</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="jax.experimental.pallas.mosaic_gpu.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pallas.mosaic_gpu</span></code> module</a></li>
<li class="toctree-l4"><a class="reference internal" href="jax.experimental.pallas.triton.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pallas.triton</span></code> module</a></li>
<li class="toctree-l4"><a class="reference internal" href="jax.experimental.pallas.tpu.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pallas.tpu</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.pjit.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pjit</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.serialize_executable.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.serialize_executable</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="jax.experimental.shard_map.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.shard_map</span></code> module</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="jax.experimental.sparse.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.sparse</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.BCOO.html">jax.experimental.sparse.BCOO</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_broadcast_in_dim.html">jax.experimental.sparse.bcoo_broadcast_in_dim</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_concatenate.html">jax.experimental.sparse.bcoo_concatenate</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_dot_general.html">jax.experimental.sparse.bcoo_dot_general</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_dot_general_sampled.html">jax.experimental.sparse.bcoo_dot_general_sampled</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_dynamic_slice.html">jax.experimental.sparse.bcoo_dynamic_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_extract.html">jax.experimental.sparse.bcoo_extract</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_fromdense.html">jax.experimental.sparse.bcoo_fromdense</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_gather.html">jax.experimental.sparse.bcoo_gather</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_multiply_dense.html">jax.experimental.sparse.bcoo_multiply_dense</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_multiply_sparse.html">jax.experimental.sparse.bcoo_multiply_sparse</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_update_layout.html">jax.experimental.sparse.bcoo_update_layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_reduce_sum.html">jax.experimental.sparse.bcoo_reduce_sum</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_reshape.html">jax.experimental.sparse.bcoo_reshape</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_slice.html">jax.experimental.sparse.bcoo_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_sort_indices.html">jax.experimental.sparse.bcoo_sort_indices</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_squeeze.html">jax.experimental.sparse.bcoo_squeeze</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_sum_duplicates.html">jax.experimental.sparse.bcoo_sum_duplicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_todense.html">jax.experimental.sparse.bcoo_todense</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/jax.experimental.sparse.bcoo_transpose.html">jax.experimental.sparse.bcoo_transpose</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jax.lib.html"><code class="docutils literal notranslate"><span class="pre">jax.lib</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.addressable_shards.html">jax.Array.addressable_shards</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.all.html">jax.Array.all</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.any.html">jax.Array.any</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.argmax.html">jax.Array.argmax</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.argmin.html">jax.Array.argmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.argpartition.html">jax.Array.argpartition</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.argsort.html">jax.Array.argsort</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.astype.html">jax.Array.astype</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.at.html">jax.Array.at</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.choose.html">jax.Array.choose</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.clip.html">jax.Array.clip</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.compress.html">jax.Array.compress</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.committed.html">jax.Array.committed</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.conj.html">jax.Array.conj</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.conjugate.html">jax.Array.conjugate</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.copy.html">jax.Array.copy</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.copy_to_host_async.html">jax.Array.copy_to_host_async</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.cumprod.html">jax.Array.cumprod</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.cumsum.html">jax.Array.cumsum</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.device.html">jax.Array.device</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.diagonal.html">jax.Array.diagonal</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.dot.html">jax.Array.dot</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.dtype.html">jax.Array.dtype</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.flat.html">jax.Array.flat</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.flatten.html">jax.Array.flatten</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.global_shards.html">jax.Array.global_shards</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.imag.html">jax.Array.imag</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.is_fully_addressable.html">jax.Array.is_fully_addressable</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.is_fully_replicated.html">jax.Array.is_fully_replicated</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.item.html">jax.Array.item</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.itemsize.html">jax.Array.itemsize</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.max.html">jax.Array.max</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.mean.html">jax.Array.mean</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.min.html">jax.Array.min</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.nbytes.html">jax.Array.nbytes</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.ndim.html">jax.Array.ndim</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.nonzero.html">jax.Array.nonzero</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.prod.html">jax.Array.prod</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.ptp.html">jax.Array.ptp</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.ravel.html">jax.Array.ravel</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.real.html">jax.Array.real</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.repeat.html">jax.Array.repeat</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.reshape.html">jax.Array.reshape</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.round.html">jax.Array.round</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.searchsorted.html">jax.Array.searchsorted</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.shape.html">jax.Array.shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.sharding.html">jax.Array.sharding</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.size.html">jax.Array.size</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.sort.html">jax.Array.sort</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.squeeze.html">jax.Array.squeeze</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.std.html">jax.Array.std</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.sum.html">jax.Array.sum</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.swapaxes.html">jax.Array.swapaxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.take.html">jax.Array.take</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.to_device.html">jax.Array.to_device</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.trace.html">jax.Array.trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.transpose.html">jax.Array.transpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.var.html">jax.Array.var</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.view.html">jax.Array.view</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.T.html">jax.Array.T</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/jax.Array.mT.html">jax.Array.mT</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About the project</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Frequently asked questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary of terms</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="config_options.html">Configuration Options</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Frequently...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/jax-ml/jax" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/faq.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Frequently asked questions (FAQ)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jit-changes-the-behavior-of-my-function"><code class="docutils literal notranslate"><span class="pre">jit</span></code> changes the behavior of my function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jit-changes-the-exact-numerics-of-outputs"><code class="docutils literal notranslate"><span class="pre">jit</span></code> changes the exact numerics of outputs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jit-decorated-function-is-very-slow-to-compile"><code class="docutils literal notranslate"><span class="pre">jit</span></code> decorated function is very slow to compile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-jit-with-methods">How to use <code class="docutils literal notranslate"><span class="pre">jit</span></code> with methods?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strategy-1-jit-compiled-helper-function">Strategy 1: JIT-compiled helper function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strategy-2-marking-self-as-static">Strategy 2: Marking <code class="docutils literal notranslate"><span class="pre">self</span></code> as static</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strategy-3-making-customclass-a-pytree">Strategy 3: Making <code class="docutils literal notranslate"><span class="pre">CustomClass</span></code> a PyTree</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-data-and-computation-placement-on-devices">Controlling data and computation placement on devices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#benchmarking-jax-code">Benchmarking JAX code</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is-jax-faster-than-numpy">Is JAX faster than NumPy?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#different-kinds-of-jax-values">Different kinds of JAX values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#buffer-donation">Buffer donation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradients-contain-nan-where-using-where">Gradients contain <cite>NaN</cite> where using <code class="docutils literal notranslate"><span class="pre">where</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-are-gradients-zero-for-functions-based-on-sort-order">Why are gradients zero for functions based on sort order?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-can-i-convert-a-jax-tracer-to-a-numpy-array">How can I convert a JAX Tracer to a NumPy array?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-some-cuda-libraries-fail-to-load-initialize">Why do some CUDA libraries fail to load/initialize?</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="frequently-asked-questions-faq">
<h1>Frequently asked questions (FAQ)<a class="headerlink" href="#frequently-asked-questions-faq" title="Link to this heading">#</a></h1>
<p>We are collecting answers to frequently asked questions here.
Contributions welcome!</p>
<section id="jit-changes-the-behavior-of-my-function">
<h2><code class="docutils literal notranslate"><span class="pre">jit</span></code> changes the behavior of my function<a class="headerlink" href="#jit-changes-the-behavior-of-my-function" title="Link to this heading">#</a></h2>
<p>If you have a Python function that changes behavior after using <a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jit()</span></code></a>, perhaps
your function uses global state, or has side-effects. In the following code, the
<code class="docutils literal notranslate"><span class="pre">impure_func</span></code> uses the global <code class="docutils literal notranslate"><span class="pre">y</span></code> and has a side-effect due to <code class="docutils literal notranslate"><span class="pre">print</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># @jit   # Different behavior with jit</span>
<span class="k">def</span> <span class="nf">impure_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inside:&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Result:&quot;</span><span class="p">,</span> <span class="n">impure_func</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>Without <code class="docutils literal notranslate"><span class="pre">jit</span></code> the output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Inside</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Result</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Inside</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Result</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Inside</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Result</span><span class="p">:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>and with <code class="docutils literal notranslate"><span class="pre">jit</span></code> it is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Inside</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Result</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Result</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Result</span><span class="p">:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>For <a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jit()</span></code></a>, the function is executed once using the Python interpreter, at which time the
<code class="docutils literal notranslate"><span class="pre">Inside</span></code> printing happens, and the first value of <code class="docutils literal notranslate"><span class="pre">y</span></code> is observed. Then, the function
is compiled and cached, and executed multiple times with different values of <code class="docutils literal notranslate"><span class="pre">x</span></code>, but
with the same first value of <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<p>Additional reading:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://docs.jax.dev/en/latest/notebooks/Common_Gotchas_in_JAX.html">JAX - The Sharp Bits</a></p></li>
</ul>
</div></blockquote>
</section>
<section id="jit-changes-the-exact-numerics-of-outputs">
<span id="faq-jit-numerics"></span><h2><code class="docutils literal notranslate"><span class="pre">jit</span></code> changes the exact numerics of outputs<a class="headerlink" href="#jit-changes-the-exact-numerics-of-outputs" title="Link to this heading">#</a></h2>
<p>Sometimes users are surprised by the fact that wrapping a function with <code class="xref py py-func docutils literal notranslate"><span class="pre">jit()</span></code>
can change the function‚Äôs outputs. For example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">0.572365</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">jit</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="n">x</span><span class="p">))</span>
<span class="go">0.5723649</span>
</pre></div>
</div>
<p>This slight difference in output comes from optimizations within the XLA compiler:
during compilation, XLA will sometimes rearrange or elide certain operations to make
the overall computation more efficient.</p>
<p>In this case, XLA utilizes the properties of the logarithm to replace <code class="docutils literal notranslate"><span class="pre">log(sqrt(x))</span></code>
with <code class="docutils literal notranslate"><span class="pre">0.5</span> <span class="pre">*</span> <span class="pre">log(x)</span></code>, which is a mathematically identical expression that can be
computed more efficiently than the original. The difference in output comes from
the fact that floating point arithmetic is only a close approximation of real math,
so different ways of computing the same expression may have subtly different results.</p>
<p>Other times, XLA‚Äôs optimizations may lead to even more drastic differences.
Consider the following example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">inf</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">jit</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="n">x</span><span class="p">))</span>
<span class="go">100.0</span>
</pre></div>
</div>
<p>In non-JIT-compiled op-by-op mode, the result is <code class="docutils literal notranslate"><span class="pre">inf</span></code> because <code class="docutils literal notranslate"><span class="pre">jnp.exp(x)</span></code>
overflows and returns <code class="docutils literal notranslate"><span class="pre">inf</span></code>. Under JIT, however, XLA recognizes that <code class="docutils literal notranslate"><span class="pre">log</span></code> is
the inverse of <code class="docutils literal notranslate"><span class="pre">exp</span></code>, and removes the operations from the compiled function,
simply returning the input. In this case, JIT compilation produces a more accurate
floating point approximation of the real result.</p>
<p>Unfortunately the full list of XLA‚Äôs algebraic simplifications is not well
documented, but if you‚Äôre familiar with C++ and curious about what types of
optimizations the XLA compiler makes, you can see them in the source code:
<a class="reference external" href="https://github.com/openxla/xla/blob/33f815e190982dac4f20d1f35adb98497a382377/xla/hlo/transforms/simplifiers/algebraic_simplifier.cc#L4851">algebraic_simplifier.cc</a>.</p>
</section>
<section id="jit-decorated-function-is-very-slow-to-compile">
<span id="faq-slow-compile"></span><h2><code class="docutils literal notranslate"><span class="pre">jit</span></code> decorated function is very slow to compile<a class="headerlink" href="#jit-decorated-function-is-very-slow-to-compile" title="Link to this heading">#</a></h2>
<p>If your <code class="docutils literal notranslate"><span class="pre">jit</span></code> decorated function takes tens of seconds (or more!) to run the
first time you call it, but executes quickly when called again, JAX is taking a
long time to trace or compile your code.</p>
<p>This is usually a sign that calling your function generates a large amount of
code in JAX‚Äôs internal representation, typically because it makes heavy use of
Python control flow such as <code class="docutils literal notranslate"><span class="pre">for</span></code> loops. For a handful of loop iterations,
Python is OK, but if you need <em>many</em> loop iterations, you should rewrite your
code to make use of JAX‚Äôs
<a class="reference external" href="https://docs.jax.dev/en/latest/control-flow.html#Structured-control-flow-primitives">structured control flow primitives</a>
(such as <code class="xref py py-func docutils literal notranslate"><span class="pre">lax.scan()</span></code>) or avoid wrapping the loop with <code class="docutils literal notranslate"><span class="pre">jit</span></code> (you can
still use <code class="docutils literal notranslate"><span class="pre">jit</span></code> decorated functions <em>inside</em> the loop).</p>
<p>If you‚Äôre not sure if this is the problem, you can try running
<a class="reference internal" href="_autosummary/jax.make_jaxpr.html#jax.make_jaxpr" title="jax.make_jaxpr"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.make_jaxpr()</span></code></a> on your function. You can expect slow compilation if the
output is many hundreds or thousands of lines long.</p>
<p>Sometimes it isn‚Äôt obvious how to rewrite your code to avoid Python loops
because your code makes use of many arrays with different shapes. The
recommended solution in this case is to make use of functions like
<a class="reference internal" href="_autosummary/jax.numpy.where.html#jax.numpy.where" title="jax.numpy.where"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.numpy.where()</span></code></a> to do your computation on padded arrays with fixed
shape.</p>
<p>If your functions are slow to compile for another reason, please open an issue
on GitHub.</p>
</section>
<section id="how-to-use-jit-with-methods">
<span id="faq-jit-class-methods"></span><h2>How to use <code class="docutils literal notranslate"><span class="pre">jit</span></code> with methods?<a class="headerlink" href="#how-to-use-jit-with-methods" title="Link to this heading">#</a></h2>
<p>Most examples of <a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jit()</span></code></a> concern decorating stand-alone Python functions,
but decorating a method within a class introduces some complication. For example,
consider the following simple class, where we‚Äôve used a standard <a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jit()</span></code></a>
annotation on a method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CustomClass</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mul</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="nd">@jit</span>  <span class="c1"># &lt;---- How to do this correctly?</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">:</span>
<span class="gp">... </span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
<p>However, this approach will result in an error when you attempt to call this method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">CustomClass</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module</span>
<span class="gr">TypeError</span>: <span class="n">Argument &#39;&lt;CustomClass object at 0x7f7dd4125890&gt;&#39; of type &lt;class &#39;CustomClass&#39;&gt; is not a valid JAX type.</span>
</pre></div>
</div>
<p>The problem is that the first argument to the function is <code class="docutils literal notranslate"><span class="pre">self</span></code>, which has type
<code class="docutils literal notranslate"><span class="pre">CustomClass</span></code>, and JAX does not know how to handle this type.
There are three basic strategies we might use in this case, and we‚Äôll discuss
them below.</p>
<section id="strategy-1-jit-compiled-helper-function">
<h3>Strategy 1: JIT-compiled helper function<a class="headerlink" href="#strategy-1-jit-compiled-helper-function" title="Link to this heading">#</a></h3>
<p>The most straightforward approach is to create a helper function external to the class
that can be JIT-decorated in the normal way. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CustomClass</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mul</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">_calc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">_calc</span><span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">if</span> <span class="n">mul</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
<p>The result will work as expected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">CustomClass</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">6</span>
</pre></div>
</div>
<p>The benefit of such an approach is that it is simple, explicit, and it avoids the need
to teach JAX how to handle objects of type <code class="docutils literal notranslate"><span class="pre">CustomClass</span></code>. However, you may wish to
keep all the method logic in the same place.</p>
</section>
<section id="strategy-2-marking-self-as-static">
<h3>Strategy 2: Marking <code class="docutils literal notranslate"><span class="pre">self</span></code> as static<a class="headerlink" href="#strategy-2-marking-self-as-static" title="Link to this heading">#</a></h3>
<p>Another common pattern is to use <code class="docutils literal notranslate"><span class="pre">static_argnums</span></code> to mark the <code class="docutils literal notranslate"><span class="pre">self</span></code> argument as static.
But this must be done with care to avoid unexpected results.
You may be tempted to simply do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CustomClass</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mul</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="c1"># WARNING: this example is broken, as we&#39;ll see below. Don&#39;t copy &amp; paste!</span>
<span class="gp">... </span>  <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">:</span>
<span class="gp">... </span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
<p>If you call the method, it will no longer raise an error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">CustomClass</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">6</span>
</pre></div>
</div>
<p>However, there is a catch: if you mutate the object after the first method call, the
subsequent method call may return an incorrect result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">mul</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>  <span class="c1"># Should print 3</span>
<span class="go">6</span>
</pre></div>
</div>
<p>Why is this? When you mark an object as static, it will effectively be used as a dictionary
key in JIT‚Äôs internal compilation cache, meaning its hash (i.e. <code class="docutils literal notranslate"><span class="pre">hash(obj)</span></code>) equality
(i.e. <code class="docutils literal notranslate"><span class="pre">obj1</span> <span class="pre">==</span> <span class="pre">obj2</span></code>) and object identity (i.e. <code class="docutils literal notranslate"><span class="pre">obj1</span> <span class="pre">is</span> <span class="pre">obj2</span></code>) will be assumed to have
consistent behavior. The default <code class="docutils literal notranslate"><span class="pre">__hash__</span></code> for a custom object is its object ID, and so
JAX has no way of knowing that a mutated object should trigger a re-compilation.</p>
<p>You can partially address this by defining an appropriate <code class="docutils literal notranslate"><span class="pre">__hash__</span></code> and <code class="docutils literal notranslate"><span class="pre">__eq__</span></code> methods
for your object; for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CustomClass</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mul</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">:</span>
<span class="gp">... </span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CustomClass</span><span class="p">)</span> <span class="ow">and</span>
<span class="gp">... </span>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">mul</span><span class="p">))</span>
</pre></div>
</div>
<p>(see the <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__hash__" title="(in Python v3.13)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">object.__hash__()</span></code></a> documentation for more discussion of the requirements
when overriding <code class="docutils literal notranslate"><span class="pre">__hash__</span></code>).</p>
<p>This should work correctly with JIT and other transforms <strong>so long as you never mutate
your object</strong>. Mutations of objects used as hash keys lead to several subtle problems,
which is why for example mutable Python containers (e.g. <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>)
don‚Äôt define <code class="docutils literal notranslate"><span class="pre">__hash__</span></code>, while their immutable counterparts (e.g. <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>) do.</p>
<p>If your class relies on in-place mutations (such as setting <code class="docutils literal notranslate"><span class="pre">self.attr</span> <span class="pre">=</span> <span class="pre">...</span></code> within its
methods), then your object is not really ‚Äústatic‚Äù and marking it as such may lead to problems.
Fortunately, there‚Äôs another option for this case.</p>
</section>
<section id="strategy-3-making-customclass-a-pytree">
<h3>Strategy 3: Making <code class="docutils literal notranslate"><span class="pre">CustomClass</span></code> a PyTree<a class="headerlink" href="#strategy-3-making-customclass-a-pytree" title="Link to this heading">#</a></h3>
<p>The most flexible approach to correctly JIT-compiling a class method is to register the
type as a custom PyTree object; see <a class="reference internal" href="pytrees.html#extending-pytrees"><span class="std std-ref">Extending pytrees</span></a>. This lets you specify
exactly which components of the class should be treated as static and which should be
treated as dynamic. Here‚Äôs how it might look:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CustomClass</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mul</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="nd">@jit</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">:</span>
<span class="gp">... </span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">_tree_flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">children</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,)</span>  <span class="c1"># arrays / dynamic values</span>
<span class="gp">... </span>    <span class="n">aux_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mul&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">}</span>  <span class="c1"># static values</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">aux_data</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="nd">@classmethod</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">_tree_unflatten</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">aux_data</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">children</span><span class="p">,</span> <span class="o">**</span><span class="n">aux_data</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">tree_util</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tree_util</span><span class="o">.</span><span class="n">register_pytree_node</span><span class="p">(</span><span class="n">CustomClass</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">CustomClass</span><span class="o">.</span><span class="n">_tree_flatten</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">CustomClass</span><span class="o">.</span><span class="n">_tree_unflatten</span><span class="p">)</span>
</pre></div>
</div>
<p>This is certainly more involved, but it solves all the issues associated with the simpler
approaches used above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">CustomClass</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">6</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">mul</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># mutation is detected</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">3</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">CustomClass</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># non-hashable x is supported</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">6</span>
</pre></div>
</div>
<p>So long as your <code class="docutils literal notranslate"><span class="pre">tree_flatten</span></code> and <code class="docutils literal notranslate"><span class="pre">tree_unflatten</span></code> functions correctly handle all
relevant attributes in the class, you should be able to use objects of this type directly
as arguments to JIT-compiled functions, without any special annotations.</p>
</section>
</section>
<section id="controlling-data-and-computation-placement-on-devices">
<span id="faq-data-placement"></span><h2>Controlling data and computation placement on devices<a class="headerlink" href="#controlling-data-and-computation-placement-on-devices" title="Link to this heading">#</a></h2>
<p>Let‚Äôs first look at the principles of data and computation placement in JAX.</p>
<p>In JAX, the computation follows data placement. JAX arrays
have two placement properties: 1) the device where the data resides;
and 2) whether it is <strong>committed</strong> to the device or not (the data is sometimes
referred to as being <em>sticky</em> to the device).</p>
<p>By default, JAX arrays are placed uncommitted on the default device
(<code class="docutils literal notranslate"><span class="pre">jax.devices()[0]</span></code>), which is the first GPU or TPU by default. If no GPU or
TPU is present, <code class="docutils literal notranslate"><span class="pre">jax.devices()[0]</span></code> is the CPU. The default device can
be temporarily overridden with the <a class="reference internal" href="_autosummary/jax.default_device.html#jax.default_device" title="jax.default_device"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.default_device()</span></code></a> context manager, or
set for the whole process by setting the environment variable <code class="docutils literal notranslate"><span class="pre">JAX_PLATFORMS</span></code>
or the absl flag <code class="docutils literal notranslate"><span class="pre">--jax_platforms</span></code> to ‚Äúcpu‚Äù, ‚Äúgpu‚Äù, or ‚Äútpu‚Äù
(<code class="docutils literal notranslate"><span class="pre">JAX_PLATFORMS</span></code> can also be a list of platforms, which determines which
platforms are available in priority order).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">jnp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">devices</span><span class="p">())</span>  
<span class="go">{CudaDevice(id=0)}</span>
</pre></div>
</div>
<p>Computations involving uncommitted data are performed on the default
device and the results are uncommitted on the default device.</p>
<p>Data can also be placed explicitly on a device using <a class="reference internal" href="_autosummary/jax.device_put.html#jax.device_put" title="jax.device_put"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.device_put()</span></code></a>
with a <code class="docutils literal notranslate"><span class="pre">device</span></code> parameter, in which case the data becomes <strong>committed</strong> to the device:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">jax</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">device_put</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">device_put</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">devices</span><span class="p">())</span>  
<span class="go">{CudaDevice(id=2)}</span>
</pre></div>
</div>
<p>Computations involving some committed inputs will happen on the
committed device and the result will be committed on the
same device. Invoking an operation on arguments that are committed
to more than one device will raise an error.</p>
<p>You can also use <a class="reference internal" href="_autosummary/jax.device_put.html#jax.device_put" title="jax.device_put"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.device_put()</span></code></a> without a <code class="docutils literal notranslate"><span class="pre">device</span></code> parameter. If the data
is already on a device (committed or not), it‚Äôs left as-is. If the data isn‚Äôt on any
device‚Äîthat is, it‚Äôs a regular Python or NumPy value‚Äîit‚Äôs placed uncommitted on the default
device.</p>
<p>Jitted functions behave like any other primitive operations‚Äîthey will follow the
data and will show errors if invoked on data committed on more than one device.</p>
<p>(Before <a class="reference external" href="https://github.com/jax-ml/jax/pull/6002">PR #6002</a> in March 2021
there was some laziness in creation of array constants, so that
<code class="docutils literal notranslate"><span class="pre">jax.device_put(jnp.zeros(...),</span> <span class="pre">jax.devices()[1])</span></code> or similar would actually
create the array of zeros on <code class="docutils literal notranslate"><span class="pre">jax.devices()[1]</span></code>, instead of creating the
array on the default device then moving it. But this optimization was removed
so as to simplify the implementation.)</p>
<p>(As of April 2020, <a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jit()</span></code></a> has a <cite>device</cite> parameter that affects the device
placement. That parameter is experimental, is likely to be removed or changed,
and its use is not recommended.)</p>
<p>For a worked-out example, we recommend reading through
<code class="docutils literal notranslate"><span class="pre">test_computation_follows_data</span></code> in
<a class="reference external" href="https://github.com/jax-ml/jax/blob/main/tests/multi_device_test.py">multi_device_test.py</a>.</p>
</section>
<section id="benchmarking-jax-code">
<span id="faq-benchmark"></span><h2>Benchmarking JAX code<a class="headerlink" href="#benchmarking-jax-code" title="Link to this heading">#</a></h2>
<p>You just ported a tricky function from NumPy/SciPy to JAX. Did that actually
speed things up?</p>
<p>Keep in mind these important differences from NumPy when measuring the
speed of code using JAX:</p>
<ol class="arabic">
<li><p><strong>JAX code is Just-In-Time (JIT) compiled.</strong> Most code written in JAX can be
written in such a way that it supports JIT compilation, which can make it run
<em>much faster</em> (see <a class="reference external" href="https://docs.jax.dev/en/latest/notebooks/thinking_in_jax.html#to-jit-or-not-to-jit">To JIT or not to JIT</a>). To get maximum performance from
JAX, you should apply <a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jit()</span></code></a> on your outer-most function calls.</p>
<p>Keep in mind that the first time you run JAX code, it will be slower because
it is being compiled. This is true even if you don‚Äôt use <code class="docutils literal notranslate"><span class="pre">jit</span></code> in your own
code, because JAX‚Äôs builtin functions are also JIT compiled.</p>
</li>
<li><p><strong>JAX has asynchronous dispatch.</strong> This means that you need to call
<code class="docutils literal notranslate"><span class="pre">.block_until_ready()</span></code> to ensure that computation has actually happened
(see <a class="reference internal" href="async_dispatch.html#async-dispatch"><span class="std std-ref">Asynchronous dispatch</span></a>).</p></li>
<li><p><strong>JAX by default only uses 32-bit dtypes.</strong> You may want to either explicitly
use 32-bit dtypes in NumPy or enable 64-bit dtypes in JAX (see
<a class="reference external" href="https://docs.jax.dev/en/latest/notebooks/Common_Gotchas_in_JAX.html#double-64bit-precision">Double (64 bit) precision</a>) for a fair comparison.</p></li>
<li><p><strong>Transferring data between CPUs and accelerators takes time.</strong> If you only
want to measure how long it takes to evaluate a function, you may want to
transfer data to the device on which you want to run it first (see
<a class="reference internal" href="#faq-data-placement"><span class="std std-ref">Controlling data and computation placement on devices</span></a>).</p></li>
</ol>
<p>Here‚Äôs an example of how to put together all these tricks into a microbenchmark
for comparing JAX versus NumPy, making using of IPython‚Äôs convenient
<a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-time">%time and %timeit magics</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">jax</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c1"># function we&#39;re benchmarking (works in both NumPy &amp; JAX)</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">x_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># same as JAX default dtype</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">f</span><span class="p">(</span><span class="n">x_np</span><span class="p">)</span>  <span class="c1"># measure NumPy runtime</span>

<span class="c1"># measure JAX device transfer time</span>
<span class="o">%</span><span class="n">time</span> <span class="n">x_jax</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">device_put</span><span class="p">(</span><span class="n">x_np</span><span class="p">)</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">()</span>

<span class="n">f_jit</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="o">%</span><span class="n">time</span> <span class="n">f_jit</span><span class="p">(</span><span class="n">x_jax</span><span class="p">)</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">()</span>  <span class="c1"># measure JAX compilation time</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">f_jit</span><span class="p">(</span><span class="n">x_jax</span><span class="p">)</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">()</span>  <span class="c1"># measure JAX runtime</span>
</pre></div>
</div>
<p>When run with a GPU in <a class="reference external" href="https://colab.research.google.com/">Colab</a>, we see:</p>
<ul class="simple">
<li><p>NumPy takes 16.2 ms per evaluation on the CPU</p></li>
<li><p>JAX takes 1.26 ms to copy the NumPy arrays onto the GPU</p></li>
<li><p>JAX takes 193 ms to compile the function</p></li>
<li><p>JAX takes 485 ¬µs per evaluation on the GPU</p></li>
</ul>
<p>In this case, we see that once the data is transferred and the function is
compiled, JAX on the GPU is about 30x faster for repeated evaluations.</p>
<p>Is this a fair comparison? Maybe. The performance that ultimately matters is for
running full applications, which inevitably include some amount of both data
transfer and compilation. Also, we were careful to pick large enough arrays
(1000x1000) and an intensive enough computation (the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> operator is
performing matrix-matrix multiplication) to amortize the increased overhead of
JAX/accelerators vs NumPy/CPU. For example, if we switch this example to use
10x10 input instead, JAX/GPU runs 10x slower than NumPy/CPU (100 ¬µs vs 10 ¬µs).</p>
<section id="is-jax-faster-than-numpy">
<span id="faq-jax-vs-numpy"></span><h3>Is JAX faster than NumPy?<a class="headerlink" href="#is-jax-faster-than-numpy" title="Link to this heading">#</a></h3>
<p>One question users frequently attempt to answer with such benchmarks is whether JAX
is faster than NumPy; due to the difference in the two packages, there is not a
simple answer.</p>
<p>Broadly speaking:</p>
<ul class="simple">
<li><p>NumPy operations are executed eagerly, synchronously, and only on CPU.</p></li>
<li><p>JAX operations may be executed eagerly or after compilation (if inside <code class="xref py py-func docutils literal notranslate"><span class="pre">jit()</span></code>);
they are dispatched asynchronously (see <a class="reference internal" href="async_dispatch.html#async-dispatch"><span class="std std-ref">Asynchronous dispatch</span></a>); and they can
be executed on CPU, GPU, or TPU, each of which have vastly different and continuously
evolving performance characteristics.</p></li>
</ul>
<p>These architectural differences make meaningful direct benchmark comparisons between
NumPy and JAX difficult.</p>
<p>Additionally, these differences have led to different engineering focus between the
packages: for example, NumPy has put significant effort into decreasing the per-call
dispatch overhead for individual array operations, because in NumPy‚Äôs computational
model that overhead cannot be avoided.
JAX, on the other hand, has several ways to avoid dispatch overhead (e.g. JIT
compilation, asynchronous dispatch, batching transforms, etc.), and so reducing
per-call overhead has been less of a priority.</p>
<p>Keeping all that in mind, in summary: if you‚Äôre doing microbenchmarks of individual
array operations on CPU, you can generally expect NumPy to outperform JAX due to its
lower per-operation dispatch overhead. If you‚Äôre running your code on GPU or TPU,
or are benchmarking more complicated JIT-compiled sequences of operations on CPU, you
can generally expect JAX to outperform NumPy.</p>
</section>
</section>
<section id="different-kinds-of-jax-values">
<span id="faq-different-kinds-of-jax-values"></span><h2>Different kinds of JAX values<a class="headerlink" href="#different-kinds-of-jax-values" title="Link to this heading">#</a></h2>
<p>In the process of transforming functions, JAX replaces some function
arguments with special tracer values.</p>
<p>You could see this if you use a <code class="docutils literal notranslate"><span class="pre">print</span></code> statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">func</span><span class="p">)(</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code does return the correct value <code class="docutils literal notranslate"><span class="pre">1.</span></code> but it also prints
<code class="docutils literal notranslate"><span class="pre">Traced&lt;ShapedArray(float32[])&gt;</span></code> for the value of <code class="docutils literal notranslate"><span class="pre">x</span></code>. Normally, JAX
handles these tracer values internally in a transparent way, e.g.,
in the numeric JAX primitives that are used to implement the
<code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> functions. This is why <code class="docutils literal notranslate"><span class="pre">jnp.cos</span></code> works in the example above.</p>
<p>More precisely, a <strong>tracer</strong> value is introduced for the argument of
a JAX-transformed function, except the arguments identified by special
parameters such as <code class="docutils literal notranslate"><span class="pre">static_argnums</span></code> for <a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jit()</span></code></a> or
<code class="docutils literal notranslate"><span class="pre">static_broadcasted_argnums</span></code> for <a class="reference internal" href="_autosummary/jax.pmap.html#jax.pmap" title="jax.pmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.pmap()</span></code></a>. Typically, computations
that involve at least a tracer value will produce a tracer value. Besides tracer
values, there are <strong>regular</strong> Python values: values that are computed outside JAX
transformations, or arise from above-mentioned static arguments of certain JAX
transformations, or computed solely from other regular Python values.
These are the values that are used everywhere in absence of JAX transformations.</p>
<p>A tracer value carries an <strong>abstract</strong> value, e.g., <code class="docutils literal notranslate"><span class="pre">ShapedArray</span></code> with information
about the shape and dtype of an array. We will refer here to such tracers as
<strong>abstract tracers</strong>. Some tracers, e.g., those that are
introduced for arguments of autodiff transformations, carry <code class="docutils literal notranslate"><span class="pre">ConcreteArray</span></code>
abstract values that actually include the regular array data, and are used,
e.g., for resolving conditionals. We will refer here to such tracers
as <strong>concrete tracers</strong>. Tracer values computed from these concrete tracers,
perhaps in combination with regular values, result in concrete tracers.
A <strong>concrete value</strong> is either a regular value or a concrete tracer.</p>
<p>Most often values computed from tracer values are themselves tracer values.
There are very few exceptions, when a computation can be entirely done
using the abstract value carried by a tracer, in which case the result
can be a regular value. For example, getting the shape of a tracer
with <code class="docutils literal notranslate"><span class="pre">ShapedArray</span></code> abstract value. Another example is when explicitly
casting a concrete tracer value to a regular type, e.g., <code class="docutils literal notranslate"><span class="pre">int(x)</span></code> or
<code class="docutils literal notranslate"><span class="pre">x.astype(float)</span></code>.
Another such situation is for <code class="docutils literal notranslate"><span class="pre">bool(x)</span></code>, which produces a Python bool when
concreteness makes it possible. That case is especially salient because
of how often it arises in control flow.</p>
<p>Here is how the transformations introduce abstract or concrete tracers:</p>
<ul class="simple">
<li><p><a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jit()</span></code></a>: introduces <strong>abstract tracers</strong> for all positional arguments
except those denoted by <code class="docutils literal notranslate"><span class="pre">static_argnums</span></code>, which remain regular
values.</p></li>
<li><p><a class="reference internal" href="_autosummary/jax.pmap.html#jax.pmap" title="jax.pmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.pmap()</span></code></a>: introduces <strong>abstract tracers</strong> for all positional arguments
except those denoted by <code class="docutils literal notranslate"><span class="pre">static_broadcasted_argnums</span></code>.</p></li>
<li><p><a class="reference internal" href="_autosummary/jax.vmap.html#jax.vmap" title="jax.vmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.vmap()</span></code></a>, <a class="reference internal" href="_autosummary/jax.make_jaxpr.html#jax.make_jaxpr" title="jax.make_jaxpr"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.make_jaxpr()</span></code></a>, <code class="xref py py-func docutils literal notranslate"><span class="pre">xla_computation()</span></code>:
introduce <strong>abstract tracers</strong> for all positional arguments.</p></li>
<li><p><a class="reference internal" href="_autosummary/jax.jvp.html#jax.jvp" title="jax.jvp"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jvp()</span></code></a> and <a class="reference internal" href="_autosummary/jax.grad.html#jax.grad" title="jax.grad"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.grad()</span></code></a> introduce <strong>concrete tracers</strong>
for all positional arguments. An exception is when these transformations
are within an outer transformation and the actual arguments are
themselves abstract tracers; in that case, the tracers introduced
by the autodiff transformations are also abstract tracers.</p></li>
<li><p>All higher-order control-flow primitives (<code class="xref py py-func docutils literal notranslate"><span class="pre">lax.cond()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">lax.while_loop()</span></code>,
<code class="xref py py-func docutils literal notranslate"><span class="pre">lax.fori_loop()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">lax.scan()</span></code>) when they process the functionals
introduce <strong>abstract tracers</strong>, whether or not there is a JAX transformation
in progress.</p></li>
</ul>
<p>All of this is relevant when you have code that can operate
only on regular Python values, such as code that has conditional
control-flow based on data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span> <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mf">1.</span> <span class="k">else</span> <span class="mf">0.</span>
</pre></div>
</div>
<p>If we want to apply <a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jit()</span></code></a>, we must ensure to specify <code class="docutils literal notranslate"><span class="pre">static_argnums=1</span></code>
to ensure <code class="docutils literal notranslate"><span class="pre">y</span></code> stays a regular value. This is due to the boolean expression
<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">&gt;=</span> <span class="pre">1.</span></code>, which requires concrete values (regular or tracers). The
same would happen if we write explicitly <code class="docutils literal notranslate"><span class="pre">bool(y</span> <span class="pre">&gt;=</span> <span class="pre">1.)</span></code>, or <code class="docutils literal notranslate"><span class="pre">int(y)</span></code>,
or <code class="docutils literal notranslate"><span class="pre">float(y)</span></code>.</p>
<p>Interestingly, <code class="docutils literal notranslate"><span class="pre">jax.grad(divide)(3.,</span> <span class="pre">2.)</span></code>, works because <a class="reference internal" href="_autosummary/jax.grad.html#jax.grad" title="jax.grad"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.grad()</span></code></a>
uses concrete tracers, and resolves the conditional using the concrete
value of <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</section>
<section id="buffer-donation">
<span id="faq-donation"></span><h2>Buffer donation<a class="headerlink" href="#buffer-donation" title="Link to this heading">#</a></h2>
<p>When JAX executes a computation it uses buffers on the device for all inputs and outputs.
If you know that one of the inputs is not needed after the computation, and if it
matches the shape and element type of one of the outputs, you can specify that you
want the corresponding input buffer to be donated to hold an output. This will reduce
the memory required for the execution by the size of the donated buffer.</p>
<p>If you have something like the following pattern, you can use buffer donation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">params</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">pmap</span><span class="p">(</span><span class="n">update_fn</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))(</span><span class="n">params</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
<p>You can think of this as a way to do a memory-efficient functional update
on your immutable JAX arrays. Within the boundaries of a computation XLA can
make this optimization for you, but at the jit/pmap boundary you need to
guarantee to XLA that you will not use the donated input buffer after calling
the donating function.</p>
<p>You achieve this by using the <cite>donate_argnums</cite> parameter to the functions <a class="reference internal" href="_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.jit()</span></code></a>,
<code class="xref py py-func docutils literal notranslate"><span class="pre">jax.pjit()</span></code>, and <a class="reference internal" href="_autosummary/jax.pmap.html#jax.pmap" title="jax.pmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.pmap()</span></code></a>. This parameter is a sequence of indices (0 based) into
the positional argument list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">device_put</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">device_put</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="c1"># Execute `add` with donation of the buffer for `y`. The result has</span>
<span class="c1"># the same shape and type as `y`, so it will share its buffer.</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this currently does not work when calling your function with key-word arguments!
The following code will not donate any buffers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">params</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">pmap</span><span class="p">(</span><span class="n">update_fn</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
<p>If an argument whose buffer is donated is a pytree, then all the buffers
for its components are donated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_ones</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Array</span><span class="p">]):</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">jax</span><span class="o">.</span><span class="n">device_put</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span> <span class="n">jax</span><span class="o">.</span><span class="n">device_put</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))]</span>
<span class="c1"># Execute `add_ones` with donation of all the buffers for `xs`.</span>
<span class="c1"># The outputs have the same shape and type as the elements of `xs`,</span>
<span class="c1"># so they will share those buffers.</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">add_ones</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">)(</span><span class="n">xs</span><span class="p">)</span>
</pre></div>
</div>
<p>It is not allowed to donate a buffer that is used subsequently in the computation,
and JAX will give an error because the buffer for <cite>y</cite> has become invalid
after it was donated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Donate the buffer for `y`</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Reuses `y` whose buffer was donated above</span>
<span class="c1"># &gt;&gt; RuntimeError: Invalid argument: CopyToHostAsync() called on invalid buffer</span>
</pre></div>
</div>
<p>You will get a warning if the donated buffer is not used, e.g., because
there are more donated buffers than can be used for the outputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Execute `add` with donation of the buffers for both `x` and `y`.</span>
<span class="c1"># One of those buffers will be used for the result, but the other will</span>
<span class="c1"># not be used.</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="c1"># &gt;&gt; UserWarning: Some donated buffers were not usable: f32[2,3]{1,0}</span>
</pre></div>
</div>
<p>The donation may also be unused if there is no output whose shape matches
the donation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">device_put</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>  <span class="c1"># `y` has different shape than the output</span>
<span class="c1"># Execute `add` with donation of the buffer for `y`.</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="c1"># &gt;&gt; UserWarning: Some donated buffers were not usable: f32[1,3]{1,0}</span>
</pre></div>
</div>
</section>
<section id="gradients-contain-nan-where-using-where">
<h2>Gradients contain <cite>NaN</cite> where using <code class="docutils literal notranslate"><span class="pre">where</span></code><a class="headerlink" href="#gradients-contain-nan-where-using-where" title="Link to this heading">#</a></h2>
<p>If you define a function using <code class="docutils literal notranslate"><span class="pre">where</span></code> to avoid an undefined value, if you
are not careful you may obtain a <code class="docutils literal notranslate"><span class="pre">NaN</span></code> for reverse differentiation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_log</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mf">0.</span><span class="p">)</span>

<span class="n">my_log</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span> <span class="o">==&gt;</span> <span class="mf">0.</span>  <span class="c1"># Ok</span>
<span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">my_log</span><span class="p">)(</span><span class="mf">0.</span><span class="p">)</span>  <span class="o">==&gt;</span> <span class="n">NaN</span>
</pre></div>
</div>
<p>A short explanation is that during <code class="docutils literal notranslate"><span class="pre">grad</span></code> computation the adjoint corresponding
to the undefined <code class="docutils literal notranslate"><span class="pre">jnp.log(x)</span></code> is a <code class="docutils literal notranslate"><span class="pre">NaN</span></code> and it gets accumulated to the
adjoint of the <code class="docutils literal notranslate"><span class="pre">jnp.where</span></code>. The correct way to write such functions is to ensure
that there is a <code class="docutils literal notranslate"><span class="pre">jnp.where</span></code> <em>inside</em> the partially-defined function, to ensure
that the adjoint is always finite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">safe_for_grad_log</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>

<span class="n">safe_for_grad_log</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span> <span class="o">==&gt;</span> <span class="mf">0.</span>  <span class="c1"># Ok</span>
<span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">safe_for_grad_log</span><span class="p">)(</span><span class="mf">0.</span><span class="p">)</span>  <span class="o">==&gt;</span> <span class="mf">0.</span>  <span class="c1"># Ok</span>
</pre></div>
</div>
<p>The inner <code class="docutils literal notranslate"><span class="pre">jnp.where</span></code> may be needed in addition to the original one, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_log_or_y</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Return log(x) if x &gt; 0 or y&quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)),</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>Additional reading:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://github.com/jax-ml/jax/issues/1052#issuecomment-514083352">Issue: gradients through jnp.where when one of branches is nan</a>.</p></li>
<li><p><a class="reference external" href="https://github.com/tensorflow/probability/blob/master/discussion/where-nan.pdf">How to avoid NaN gradients when using where</a>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="why-are-gradients-zero-for-functions-based-on-sort-order">
<h2>Why are gradients zero for functions based on sort order?<a class="headerlink" href="#why-are-gradients-zero-for-functions-based-on-sort-order" title="Link to this heading">#</a></h2>
<p>If you define a function that processes the input using operations that depend on
the relative ordering of inputs (e.g. <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">greater</span></code>, <code class="docutils literal notranslate"><span class="pre">argsort</span></code>, etc.) then
you may be surprised to find that the gradient is everywhere zero.
Here is an example, where we define <cite>f(x)</cite> to be a step function that returns
<cite>0</cite> when <cite>x</cite> is negative, and <cite>1</cite> when <cite>x</cite> is positive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f(x)  = </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># f(x)  = [0. 0. 0. 1. 1.]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;df(x) = </span><span class="si">{</span><span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># df(x) = [0. 0. 0. 0. 0.]</span>
</pre></div>
</div>
<p>The fact that the gradient is everywhere zero may be confusing at first glance:
after all, the output does change in response to the input, so how can the gradient
be zero? However, zero turns out to be the correct result in this case.</p>
<p>Why is this? Remember that what differentiation is measuring the change in <code class="docutils literal notranslate"><span class="pre">f</span></code>
given an infinitesimal change in <code class="docutils literal notranslate"><span class="pre">x</span></code>. For <code class="docutils literal notranslate"><span class="pre">x=1.0</span></code>, <code class="docutils literal notranslate"><span class="pre">f</span></code> returns <code class="docutils literal notranslate"><span class="pre">1.0</span></code>.
If we perturb <code class="docutils literal notranslate"><span class="pre">x</span></code> to make it slightly larger or smaller, this does not change
the output, so by definition, <code class="code docutils literal notranslate"><span class="pre">grad(f)(1.0)</span></code> should be zero.
This same logic holds for all values of <code class="docutils literal notranslate"><span class="pre">f</span></code> greater than zero: infinitesimally
perturbing the input does not change the output, so the gradient is zero.
Similarly, for all values of <code class="docutils literal notranslate"><span class="pre">x</span></code> less than zero, the output is zero.
Perturbing <code class="docutils literal notranslate"><span class="pre">x</span></code> does not change this output, so the gradient is zero.
That leaves us with the tricky case of <code class="docutils literal notranslate"><span class="pre">x=0</span></code>. Surely, if you perturb <code class="docutils literal notranslate"><span class="pre">x</span></code> upward,
it will change the output, but this is problematic: an infinitesimal change in <code class="docutils literal notranslate"><span class="pre">x</span></code>
produces a finite change in the function value, which implies the gradient is
undefined.
Fortunately, there‚Äôs another way for us to measure the gradient in this case: we
perturb the function downward, in which case the output does not change, and so the
gradient is zero.
JAX and other autodiff systems tend to handle discontinuities in this way: if the
positive gradient and negative gradient disagree, but one is defined and the other is
not, we use the one that is defined.
Under this definition of the gradient, mathematically and numerically the gradient of
this function is everywhere zero.</p>
<p>The problem stems from the fact that our function has a discontinuity at <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">0</span></code>.
Our <code class="docutils literal notranslate"><span class="pre">f</span></code> here is essentially a <a class="reference external" href="https://en.wikipedia.org/wiki/Heaviside_step_function">Heaviside Step Function</a>, and we can use a
<a class="reference external" href="https://en.wikipedia.org/wiki/Sigmoid_function">Sigmoid Function</a> as a smoothed replacement.
The sigmoid is approximately equal to the heaviside function when <cite>x</cite> is far from zero,
but replaces the discontinuity at <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">0</span></code> with a smooth, differentiable curve.
As a result of using <a class="reference internal" href="_autosummary/jax.nn.sigmoid.html#jax.nn.sigmoid" title="jax.nn.sigmoid"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.nn.sigmoid()</span></code></a>, we get a similar computation with
well-defined gradients:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">dg</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>

<span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;g(x)  = </span><span class="si">{</span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="c1"># g(x)  = [0.   0.27 0.5  0.73 1.  ]</span>

  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dg(x) = </span><span class="si">{</span><span class="n">dg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="c1"># dg(x) = [0.   0.2  0.25 0.2  0.  ]</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="jax.nn.html#module-jax.nn" title="jax.nn"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jax.nn</span></code></a> submodule also has smooth versions of other common rank-based
functions, for example <a class="reference internal" href="_autosummary/jax.nn.softmax.html#jax.nn.softmax" title="jax.nn.softmax"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.nn.softmax()</span></code></a> can replace uses of
<a class="reference internal" href="_autosummary/jax.numpy.argmax.html#jax.numpy.argmax" title="jax.numpy.argmax"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.numpy.argmax()</span></code></a>, <a class="reference internal" href="_autosummary/jax.nn.soft_sign.html#jax.nn.soft_sign" title="jax.nn.soft_sign"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.nn.soft_sign()</span></code></a> can replace uses of
<a class="reference internal" href="_autosummary/jax.numpy.sign.html#jax.numpy.sign" title="jax.numpy.sign"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.numpy.sign()</span></code></a>, <a class="reference internal" href="_autosummary/jax.nn.softplus.html#jax.nn.softplus" title="jax.nn.softplus"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.nn.softplus()</span></code></a> or <a class="reference internal" href="_autosummary/jax.nn.squareplus.html#jax.nn.squareplus" title="jax.nn.squareplus"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.nn.squareplus()</span></code></a>
can replace uses of <a class="reference internal" href="_autosummary/jax.nn.relu.html#jax.nn.relu" title="jax.nn.relu"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.nn.relu()</span></code></a>, etc.</p>
</section>
<section id="how-can-i-convert-a-jax-tracer-to-a-numpy-array">
<h2>How can I convert a JAX Tracer to a NumPy array?<a class="headerlink" href="#how-can-i-convert-a-jax-tracer-to-a-numpy-array" title="Link to this heading">#</a></h2>
<p>When inspecting a transformed JAX function at runtime, you‚Äôll find that array
values are replaced by <cite>jax.core.Tracer</cite> objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">x</span>

<span class="n">f</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>This prints the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;jax.interpreters.partial_eval.DynamicJaxprTracer&#39;&gt;
</pre></div>
</div>
<p>A frequent question is how such a tracer can be converted back to a normal NumPy
array. In short, <strong>it is impossible to convert a Tracer to a NumPy array</strong>, because
a tracer is an abstract representation of <em>every possible</em> value with a given shape
and dtype, while a numpy array is a concrete member of that abstract class.
For more discussion of how tracers work within the context of JAX transformations,
see <a class="reference external" href="https://docs.jax.dev/en/latest/notebooks/thinking_in_jax.html#jit-mechanics-tracing-and-static-variables">JIT mechanics</a>.</p>
<p>The question of converting Tracers back to arrays usually comes up within
the context of another goal, related to accessing intermediate values in a
computation at runtime. For example:</p>
<ul class="simple">
<li><p>If you wish to print a traced value at runtime for debugging purposes, you might
consider using <a class="reference internal" href="_autosummary/jax.debug.print.html#jax.debug.print" title="jax.debug.print"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.debug.print()</span></code></a>.</p></li>
<li><p>If you wish to call non-JAX code within a transformed JAX function, you might
consider using <a class="reference internal" href="_autosummary/jax.pure_callback.html#jax.pure_callback" title="jax.pure_callback"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.pure_callback()</span></code></a>, an example of which is available at
<a class="reference external" href="https://docs.jax.dev/en/latest/notebooks/external_callbacks.html#example-pure-callback-with-custom-jvp">Pure callback example</a>.</p></li>
<li><p>If you wish to input or output array buffers at runtime (for example, load data
from file, or log the contents of the array to disk), you might consider using
<a class="reference internal" href="_autosummary/jax.experimental.io_callback.html#jax.experimental.io_callback" title="jax.experimental.io_callback"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.experimental.io_callback()</span></code></a>, an example of which can be found at
<a class="reference external" href="https://docs.jax.dev/en/latest/notebooks/external_callbacks.html#exploring-jax-experimental-io-callback">IO callback example</a>.</p></li>
</ul>
<p>For more information on runtime callbacks and examples of their use,
see <a class="reference external" href="https://docs.jax.dev/en/latest/notebooks/external_callbacks.html">External callbacks in JAX</a>.</p>
</section>
<section id="why-do-some-cuda-libraries-fail-to-load-initialize">
<h2>Why do some CUDA libraries fail to load/initialize?<a class="headerlink" href="#why-do-some-cuda-libraries-fail-to-load-initialize" title="Link to this heading">#</a></h2>
<p>When resolving dynamic libraries, JAX uses the usual <a class="reference external" href="https://man7.org/linux/man-pages/man8/ld.so.8.html">dynamic linker search pattern</a>.
JAX sets <code class="code docutils literal notranslate"><span class="pre">RPATH</span></code> to point to the JAX-relative location of the
pip-installed NVIDIA CUDA packages, preferring them if installed. If <code class="code docutils literal notranslate"><span class="pre">ld.so</span></code>
cannot find your CUDA runtime libraries along its usual search path, then you
must include the paths to those libraries explicitly in <code class="code docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>.
The easiest way to ensure your CUDA files are discoverable is to simply install
the <code class="code docutils literal notranslate"><span class="pre">nvidia-*-cu12</span></code> pip packages, which are included in the standard
<code class="code docutils literal notranslate"><span class="pre">jax[cuda_12]</span></code> install option.</p>
<p>Occasionally, even when you have ensured that your runtime libraries are discoverable,
there may still be some issues with loading or initializing them. A common cause of
such issues is simply having insufficient memory for CUDA library initialization at
runtime. This sometimes occurs because JAX will pre-allocate too large of a chunk of
currently available device memory for faster execution, occasionally resulting in
insufficient memory being left available for runtime CUDA library initialization.</p>
<p>This is especially likely when running multiple JAX instances, running JAX in
tandem with TensorFlow which performs its own pre-allocation, or when running
JAX on a system where the GPU is being heavily utilized by other processes. When
in doubt, try running the program again with reduced pre-allocation, either by
reducing <code class="code docutils literal notranslate"><span class="pre">XLA_PYTHON_CLIENT_MEM_FRACTION</span></code> from the default of <code class="code docutils literal notranslate"><span class="pre">.75</span></code>,
or setting <code class="code docutils literal notranslate"><span class="pre">XLA_PYTHON_CLIENT_PREALLOCATE=false</span></code>. For more details, please
see the page on <a class="reference external" href="https://docs.jax.dev/en/latest/gpu_memory_allocation.html">JAX GPU memory allocation</a>.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="about.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">About the project</p>
      </div>
    </a>
    <a class="right-next"
       href="changelog.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Change log</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jit-changes-the-behavior-of-my-function"><code class="docutils literal notranslate"><span class="pre">jit</span></code> changes the behavior of my function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jit-changes-the-exact-numerics-of-outputs"><code class="docutils literal notranslate"><span class="pre">jit</span></code> changes the exact numerics of outputs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jit-decorated-function-is-very-slow-to-compile"><code class="docutils literal notranslate"><span class="pre">jit</span></code> decorated function is very slow to compile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-jit-with-methods">How to use <code class="docutils literal notranslate"><span class="pre">jit</span></code> with methods?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strategy-1-jit-compiled-helper-function">Strategy 1: JIT-compiled helper function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strategy-2-marking-self-as-static">Strategy 2: Marking <code class="docutils literal notranslate"><span class="pre">self</span></code> as static</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strategy-3-making-customclass-a-pytree">Strategy 3: Making <code class="docutils literal notranslate"><span class="pre">CustomClass</span></code> a PyTree</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-data-and-computation-placement-on-devices">Controlling data and computation placement on devices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#benchmarking-jax-code">Benchmarking JAX code</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is-jax-faster-than-numpy">Is JAX faster than NumPy?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#different-kinds-of-jax-values">Different kinds of JAX values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#buffer-donation">Buffer donation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradients-contain-nan-where-using-where">Gradients contain <cite>NaN</cite> where using <code class="docutils literal notranslate"><span class="pre">where</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-are-gradients-zero-for-functions-based-on-sort-order">Why are gradients zero for functions based on sort order?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-can-i-convert-a-jax-tracer-to-a-numpy-array">How can I convert a JAX Tracer to a NumPy array?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-some-cuda-libraries-fail-to-load-initialize">Why do some CUDA libraries fail to load/initialize?</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The JAX authors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024, The JAX Authors.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>