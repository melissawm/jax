
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Type Annotation Roadmap for JAX &#8212; JAX  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=17fd2dad" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'jep/12049-type-annotations';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="shmap (shard_map) for simple per-device code" href="14273-shard-map.html" />
    <link rel="prev" title="jax.remat / jax.checkpoint changes: what you need to know" href="11830-new-remat-checkpoint.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/jax_logo_250px.png" class="logo__image only-light" alt="JAX  documentation - Home"/>
    <script>document.write(`<img src="../_static/jax_logo_250px.png" class="logo__image only-dark" alt="JAX  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/thinking_in_jax.html">Quickstart: How to think in JAX</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../notebooks/Common_Gotchas_in_JAX.html">üî™ JAX - The Sharp Bits üî™</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../jax-101.html">JAX 101</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../jit-compilation.html">Just-in-time compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../automatic-vectorization.html">Automatic vectorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../automatic-differentiation.html">Automatic differentiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working-with-pytrees.html">Working with pytrees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../random-numbers.html">Pseudorandom numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../control-flow.html">Control flow and logical operators with JIT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stateful-computations.html">Stateful computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sharded-computation.html">Introduction to parallel programming</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources, guides, and references</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../key-concepts.html">Key concepts</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced_guides.html">Resources and Advanced Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/Distributed_arrays_and_automatic_parallelization.html">Distributed arrays and automatic parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/explicit-sharding.html">Explicit sharding (a.k.a. ‚Äúsharding in types‚Äù)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/shard_map.html">Manual parallelism with <code class="docutils literal notranslate"><span class="pre">shard_map</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/layout.html">Device-local array layout control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/host-offloading.html">JAX Memories and Host Offloading</a></li>

<li class="toctree-l2"><a class="reference internal" href="../multi_process.html">Introduction to multi-controller JAX (aka multi-process/multi-host JAX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../distributed_data_loading.html">Distributed data loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../the-training-cookbook.html">The Training Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/autodiff_cookbook.html">The Autodiff Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/Custom_derivative_rules_for_Python_code.html">Custom derivative rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/autodiff_remat.html">Control autodiff‚Äôs saved values with <code class="docutils literal notranslate"><span class="pre">jax.checkpoint</span></code> (aka <code class="docutils literal notranslate"><span class="pre">jax.remat</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-autodiff.html">Advanced automatic differentiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../errors.html">Errors</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../debugging.html">Introduction to debugging</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../debugging/print_breakpoint.html">Compiled prints and breakpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debugging/checkify_guide.html">The <code class="docutils literal notranslate"><span class="pre">checkify</span></code> transformation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../debugging/flags.html">JAX debugging flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transfer_guard.html">Transfer guard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pytrees.html">Pytrees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../persistent_compilation_cache.html">Persistent compilation cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpu_performance_tips.html">GPU performance tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../profiling.html">Profiling computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_memory_profiling.html">Profiling device memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../array_refs.html"><code class="docutils literal notranslate"><span class="pre">ArrayRef</span></code>: mutable arrays for data plumbing and memory control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../external-callbacks.html">External callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ffi.html">Foreign function interface (FFI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gradient-checkpointing.html">Gradient checkpointing with <code class="docutils literal notranslate"><span class="pre">jax.checkpoint</span></code> (<code class="docutils literal notranslate"><span class="pre">jax.remat</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aot.html">Ahead-of-time lowering and compilation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../export/index.html">Exporting and serialization</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../export/export.html">Exporting and serializing staged-out computations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../export/shape_poly.html">Shape polymorphism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../export/jax2tf.html">Interoperation with TensorFlow</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../pallas/index.html">Pallas: a JAX kernel language</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../pallas/quickstart.html">Pallas Quickstart</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pallas/pipelining.html">Software Pipelining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pallas/grid_blockspec.html">Grids and BlockSpecs</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../pallas/tpu/index.html">Pallas TPU</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../pallas/tpu/details.html">Writing TPU kernels with Pallas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pallas/tpu/pipelining.html">TPU Pipelining</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pallas/tpu/matmul.html">Matrix Multiplication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pallas/tpu/sparse.html">Scalar Prefetch and Block-Sparse Computation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pallas/tpu/distributed.html">Distributed Computing in Pallas for TPUs</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../pallas/gpu/index.html">Pallas:Mosaic GPU</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../pallas/gpu/reference.html">Writing Mosaic GPU kernels with Pallas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pallas/gpu/pipelining.html">Mosaic GPU Pipelining</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../pallas/design/index.html">Pallas Design Notes</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../pallas/design/design.html">Pallas Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pallas/design/async_note.html">Pallas Async Operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../pallas/CHANGELOG.html">Pallas Changelog</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/neural_network_with_tfds_data.html">Training a simple neural network, with tensorflow/datasets data loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/Neural_Network_and_Data_Loading.html">Training a simple neural network, with PyTorch data loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/vmapped_log_probs.html">Autobatching for Bayesian inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/convolutions.html">Generalized convolutions in JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xla_flags.html">XLA compiler flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax-primitives.html">JAX Internals: primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jaxpr.html">JAX internals: The jaxpr language</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../contributor_guide.html">Developer notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../contributing.html">Contributing to JAX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer.html">Building from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../investigating_a_regression.html">Investigating a regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../autodidax.html">Autodidax: JAX core from scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../autodidax2_part1.html">Autodidax2, part 1: JAX from scratch, again</a></li>

<li class="toctree-l2 current active has-children"><a class="reference internal" href="index.html">JAX Enhancement Proposals (JEPs)</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="263-prng.html">263: JAX PRNG Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="2026-custom-derivatives.html">2026: Custom JVP/VJP rules for JAX-transformable functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="4008-custom-vjp-update.html">4008: Custom VJP and `nondiff_argnums` update</a></li>
<li class="toctree-l3"><a class="reference internal" href="4410-omnistaging.html">4410: Omnistaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="9263-typed-keys.html">9263: Typed keys &amp; pluggable RNGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="9407-type-promotion.html">9407: Design of Type Promotion Semantics for JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="9419-jax-versioning.html">9419: Jax and Jaxlib versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="10657-sequencing-effects.html">10657: Sequencing side-effects in JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="11830-new-remat-checkpoint.html">11830: `jax.remat` / `jax.checkpoint` new implementation</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">12049: Type Annotation Roadmap for JAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="14273-shard-map.html">14273: `shard_map` (`shmap`) for simple per-device code</a></li>
<li class="toctree-l3"><a class="reference internal" href="15856-jex.html">15856: `jax.extend`, an extensions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="17111-shmap-transpose.html">17111: Efficient transposition of `shard_map` (and other maps)</a></li>
<li class="toctree-l3"><a class="reference internal" href="18137-numpy-scipy-scope.html">18137: Scope of JAX NumPy &amp; SciPy Wrappers</a></li>
<li class="toctree-l3"><a class="reference internal" href="25516-effver.html">25516: Effort-based versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="28661-jax-array-protocol.html">28661: Supporting the `__jax_array__` protocol</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../internals/index.html">JAX Internal Implementation Notes</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../internals/constants.html">Handling of closed-over constants</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../extensions.html">Extension guides</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/Writing_custom_interpreters_in_Jax.html">Writing custom Jaxpr interpreters in JAX</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.extend.html"><code class="docutils literal notranslate"><span class="pre">jax.extend</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.core.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.core</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.linear_util.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.linear_util</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.mlir.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.mlir</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.random.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.random</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../building_on_jax.html">Building on JAX</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../notes.html">Notes</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_compatibility.html">API compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deprecation.html">Python and NumPy version support policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../async_dispatch.html">Asynchronous dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concurrency.html">Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpu_memory_allocation.html">GPU memory allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rank_promotion_warning.html">Rank promotion warning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../type_promotion.html">Type promotion semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../default_dtypes.html">Default dtypes and the X64 flag</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../jax.html">Public API: <code class="docutils literal notranslate"><span class="pre">jax</span></code> package</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.numpy.html"><code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fft.html">jax.numpy.fft.fft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fft2.html">jax.numpy.fft.fft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fftfreq.html">jax.numpy.fft.fftfreq</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fftn.html">jax.numpy.fft.fftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.fftshift.html">jax.numpy.fft.fftshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.hfft.html">jax.numpy.fft.hfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ifft.html">jax.numpy.fft.ifft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ifft2.html">jax.numpy.fft.ifft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ifftn.html">jax.numpy.fft.ifftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ifftshift.html">jax.numpy.fft.ifftshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.ihfft.html">jax.numpy.fft.ihfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.irfft.html">jax.numpy.fft.irfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.irfft2.html">jax.numpy.fft.irfft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.irfftn.html">jax.numpy.fft.irfftn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.rfft.html">jax.numpy.fft.rfft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.rfft2.html">jax.numpy.fft.rfft2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.rfftfreq.html">jax.numpy.fft.rfftfreq</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.numpy.fft.rfftn.html">jax.numpy.fft.rfftn</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.scipy.html"><code class="docutils literal notranslate"><span class="pre">jax.scipy</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.scipy.stats.bernoulli.logpmf.html">jax.scipy.stats.bernoulli.logpmf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.scipy.stats.bernoulli.pmf.html">jax.scipy.stats.bernoulli.pmf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.scipy.stats.bernoulli.cdf.html">jax.scipy.stats.bernoulli.cdf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/jax.scipy.stats.bernoulli.ppf.html">jax.scipy.stats.bernoulli.ppf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../jax.lax.html"><code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.random.html"><code class="docutils literal notranslate"><span class="pre">jax.random</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.sharding.html"><code class="docutils literal notranslate"><span class="pre">jax.sharding</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.debug.html"><code class="docutils literal notranslate"><span class="pre">jax.debug</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.dlpack.html"><code class="docutils literal notranslate"><span class="pre">jax.dlpack</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.distributed.html"><code class="docutils literal notranslate"><span class="pre">jax.distributed</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.dtypes.html"><code class="docutils literal notranslate"><span class="pre">jax.dtypes</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.ffi.html"><code class="docutils literal notranslate"><span class="pre">jax.ffi</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.flatten_util.html"><code class="docutils literal notranslate"><span class="pre">jax.flatten_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.image.html"><code class="docutils literal notranslate"><span class="pre">jax.image</span></code> module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.nn.html"><code class="docutils literal notranslate"><span class="pre">jax.nn</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jax.nn.initializers.html"><code class="docutils literal notranslate"><span class="pre">jax.nn.initializers</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../jax.ops.html"><code class="docutils literal notranslate"><span class="pre">jax.ops</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.profiler.html"><code class="docutils literal notranslate"><span class="pre">jax.profiler</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.ref.html"><code class="docutils literal notranslate"><span class="pre">jax.ref</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.stages.html"><code class="docutils literal notranslate"><span class="pre">jax.stages</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.test_util.html"><code class="docutils literal notranslate"><span class="pre">jax.test_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.tree.html"><code class="docutils literal notranslate"><span class="pre">jax.tree</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.tree_util.html"><code class="docutils literal notranslate"><span class="pre">jax.tree_util</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.typing.html"><code class="docutils literal notranslate"><span class="pre">jax.typing</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jax.export.html"><code class="docutils literal notranslate"><span class="pre">jax.export</span></code> module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.extend.html"><code class="docutils literal notranslate"><span class="pre">jax.extend</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.core.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.core</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.linear_util.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.linear_util</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.mlir.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.mlir</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.extend.random.html"><code class="docutils literal notranslate"><span class="pre">jax.extend.random</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.example_libraries.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jax.example_libraries.optimizers.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries.optimizers</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.example_libraries.stax.html"><code class="docutils literal notranslate"><span class="pre">jax.example_libraries.stax</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../jax.experimental.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.checkify.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.checkify</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.compilation_cache.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.compilation_cache</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.custom_dce.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.custom_dce</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.custom_partitioning.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.custom_partitioning</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.jet.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.jet</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.key_reuse.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.key_reuse</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.mesh_utils.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.mesh_utils</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.multihost_utils.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.multihost_utils</span></code> module</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../jax.experimental.pallas.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pallas</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../jax.experimental.pallas.mosaic_gpu.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pallas.mosaic_gpu</span></code> module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../jax.experimental.pallas.triton.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pallas.triton</span></code> module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../jax.experimental.pallas.tpu.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pallas.tpu</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.pjit.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.pjit</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.serialize_executable.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.serialize_executable</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../jax.experimental.shard_map.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.shard_map</span></code> module</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../jax.experimental.sparse.html"><code class="docutils literal notranslate"><span class="pre">jax.experimental.sparse</span></code> module</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.BCOO.html">jax.experimental.sparse.BCOO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_broadcast_in_dim.html">jax.experimental.sparse.bcoo_broadcast_in_dim</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_concatenate.html">jax.experimental.sparse.bcoo_concatenate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_dot_general.html">jax.experimental.sparse.bcoo_dot_general</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_dot_general_sampled.html">jax.experimental.sparse.bcoo_dot_general_sampled</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_dynamic_slice.html">jax.experimental.sparse.bcoo_dynamic_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_extract.html">jax.experimental.sparse.bcoo_extract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_fromdense.html">jax.experimental.sparse.bcoo_fromdense</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_gather.html">jax.experimental.sparse.bcoo_gather</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_multiply_dense.html">jax.experimental.sparse.bcoo_multiply_dense</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_multiply_sparse.html">jax.experimental.sparse.bcoo_multiply_sparse</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_update_layout.html">jax.experimental.sparse.bcoo_update_layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_reduce_sum.html">jax.experimental.sparse.bcoo_reduce_sum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_reshape.html">jax.experimental.sparse.bcoo_reshape</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_slice.html">jax.experimental.sparse.bcoo_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_sort_indices.html">jax.experimental.sparse.bcoo_sort_indices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_squeeze.html">jax.experimental.sparse.bcoo_squeeze</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_sum_duplicates.html">jax.experimental.sparse.bcoo_sum_duplicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_todense.html">jax.experimental.sparse.bcoo_todense</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/jax.experimental.sparse.bcoo_transpose.html">jax.experimental.sparse.bcoo_transpose</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../jax.lib.html"><code class="docutils literal notranslate"><span class="pre">jax.lib</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.addressable_shards.html">jax.Array.addressable_shards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.all.html">jax.Array.all</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.any.html">jax.Array.any</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.argmax.html">jax.Array.argmax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.argmin.html">jax.Array.argmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.argpartition.html">jax.Array.argpartition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.argsort.html">jax.Array.argsort</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.astype.html">jax.Array.astype</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.at.html">jax.Array.at</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.choose.html">jax.Array.choose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.clip.html">jax.Array.clip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.compress.html">jax.Array.compress</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.committed.html">jax.Array.committed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.conj.html">jax.Array.conj</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.conjugate.html">jax.Array.conjugate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.copy.html">jax.Array.copy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.copy_to_host_async.html">jax.Array.copy_to_host_async</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.cumprod.html">jax.Array.cumprod</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.cumsum.html">jax.Array.cumsum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.device.html">jax.Array.device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.diagonal.html">jax.Array.diagonal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.dot.html">jax.Array.dot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.dtype.html">jax.Array.dtype</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.flat.html">jax.Array.flat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.flatten.html">jax.Array.flatten</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.global_shards.html">jax.Array.global_shards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.imag.html">jax.Array.imag</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.is_fully_addressable.html">jax.Array.is_fully_addressable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.is_fully_replicated.html">jax.Array.is_fully_replicated</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.item.html">jax.Array.item</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.itemsize.html">jax.Array.itemsize</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.max.html">jax.Array.max</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.mean.html">jax.Array.mean</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.min.html">jax.Array.min</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.nbytes.html">jax.Array.nbytes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.ndim.html">jax.Array.ndim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.nonzero.html">jax.Array.nonzero</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.prod.html">jax.Array.prod</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.ptp.html">jax.Array.ptp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.ravel.html">jax.Array.ravel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.real.html">jax.Array.real</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.repeat.html">jax.Array.repeat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.reshape.html">jax.Array.reshape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.round.html">jax.Array.round</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.searchsorted.html">jax.Array.searchsorted</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.shape.html">jax.Array.shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.sharding.html">jax.Array.sharding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.size.html">jax.Array.size</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.sort.html">jax.Array.sort</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.squeeze.html">jax.Array.squeeze</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.std.html">jax.Array.std</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.sum.html">jax.Array.sum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.swapaxes.html">jax.Array.swapaxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.take.html">jax.Array.take</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.to_device.html">jax.Array.to_device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.trace.html">jax.Array.trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.transpose.html">jax.Array.transpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.var.html">jax.Array.var</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.view.html">jax.Array.view</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.T.html">jax.Array.T</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/jax.Array.mT.html">jax.Array.mT</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About the project</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently asked questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary of terms</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../config_options.html">Configuration Options</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../contributor_guide.html" class="nav-link">Developer notes</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">JAX Enhancement Proposals (JEPs)</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Type...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/jax-ml/jax" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/jep/12049-type-annotations.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Type Annotation Roadmap for JAX</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-type-annotations">Why type annotations?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#level-1-annotations-as-documentation">Level 1: Annotations as documentation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#level-2-annotations-for-intelligent-autocomplete">Level 2: Annotations for intelligent autocomplete</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#level-3-annotations-for-static-type-checking">Level 3: Annotations for static type-checking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-annotation-challenges-for-jax">Type annotation challenges for JAX</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-1-pytype-mypy-and-developer-friction">Challenge 1: pytype, mypy and developer friction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-2-array-duck-typing">Challenge 2: array duck-typing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-3-transformations-and-decorators">Challenge 3: transformations and decorators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-4-array-annotation-lack-of-granularity">Challenge 4: array annotation lack of granularity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-5-imprecise-apis-inherited-from-numpy">Challenge 5: imprecise APIs inherited from NumPy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jax-type-annotation-roadmap">JAX type annotation roadmap</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#guiding-principles">Guiding Principles</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose-of-type-annotations">Purpose of type annotations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#annotate-for-intent">Annotate for intent</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs-should-be-permissively-typed">Inputs should be permissively-typed</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs-should-be-strictly-typed">Outputs should be strictly-typed</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#err-toward-simplicity">Err toward simplicity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#avoid-unstable-typing-mechanisms">Avoid unstable typing mechanisms</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#array-type-design-considerations"><code class="docutils literal notranslate"><span class="pre">Array</span></code> Type Design Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#static-type-annotations">Static type annotations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-instance-checks">Runtime instance checks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#following-numpy-s-lead">Following NumPy‚Äôs lead</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unifying-instance-checks-and-annotation">Unifying instance checks and annotation</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#option-1-partial-unification">Option 1: Partial unification</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#option-2-full-unification-via-overrides">Option 2: Full unification via overrides</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#option-3-full-unification-via-class-hierarchy">Option 3: Full unification via class hierarchy</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#option-4-partial-unification-via-class-hierarchy">Option 4: Partial unification via class hierarchy</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation">Evaluation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-plan">Implementation Plan</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="type-annotation-roadmap-for-jax">
<h1>Type Annotation Roadmap for JAX<a class="headerlink" href="#type-annotation-roadmap-for-jax" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p><em>Author: jakevdp</em></p></li>
<li><p><em>Date: August 2022</em></p></li>
</ul>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>Python 3.0 introduced optional function annotations (<a class="reference external" href="https://peps.python.org/pep-3107/">PEP 3107</a>), which were later codified for use in static type checking around the release of Python 3.5 (<a class="reference external" href="https://peps.python.org/pep-0484/">PEP 484</a>).
To some degree, type annotations and static type checking have become an integral part of many Python development workflows, and to this end we have added annotations in a number of places throughout the JAX API.
The current state of type annotations in JAX is a bit patchwork, and efforts to add more have been hampered by more fundamental design questions.
This doc attempts to summarize those issues and generate a roadmap for the goals and non-goals of type annotations in JAX.</p>
<p>Why do we need such a roadmap? Better/more comprehensive type annotations are a frequent request from users, both internally and externally.
In addition, we frequently receive pull requests from external users (for example, <a class="reference external" href="https://github.com/jax-ml/jax/pull/9917">PR #9917</a>, <a class="reference external" href="https://github.com/jax-ml/jax/pull/10322">PR #10322</a>) seeking to improve JAX‚Äôs type annotations: it‚Äôs not always clear to the JAX team member reviewing the code whether such contributions are beneficial, particularly when they introduce complex Protocols to address the challenges inherent to full-fledged annotation of JAX‚Äôs use of Python.
This document details JAX‚Äôs goals and recommendations for type annotations within the package.</p>
</section>
<section id="why-type-annotations">
<h2>Why type annotations?<a class="headerlink" href="#why-type-annotations" title="Link to this heading">#</a></h2>
<p>There are a number of reasons that a Python project might wish to annotate their code-base; we‚Äôll summarize them in this document as Level 1, Level 2, and Level 3.</p>
<section id="level-1-annotations-as-documentation">
<h3>Level 1: Annotations as documentation<a class="headerlink" href="#level-1-annotations-as-documentation" title="Link to this heading">#</a></h3>
<p>When originally introduced in <a class="reference external" href="https://peps.python.org/pep-3107/">PEP 3107</a>, type annotations were motivated partly by the ability to use them as concise, inline documentation of function parameter types and return types. JAX has long utilized annotations in this manner; an example is the common pattern of creating type names aliased to <code class="docutils literal notranslate"><span class="pre">Any</span></code>. An example can be found in <code class="docutils literal notranslate"><span class="pre">lax/slicing.py</span></code> [<a class="reference external" href="https://github.com/jax-ml/jax/blob/2bc3e39cd9104071ee39dacac22abd51b94eb27e/jax/_src/lax/slicing.py#L47-L58">source</a>]:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span> <span class="o">=</span> <span class="n">Any</span>
<span class="n">Shape</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Shape</span>

<span class="k">def</span><span class="w"> </span><span class="nf">slice</span><span class="p">(</span><span class="n">operand</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">start_indices</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
          <span class="n">limit_indices</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
          <span class="n">strides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>For the purposes of static type checking, this use of <code class="docutils literal notranslate"><span class="pre">Array</span> <span class="pre">=</span> <span class="pre">Any</span></code> for array type annotations puts no constraint on the argument values (<code class="docutils literal notranslate"><span class="pre">Any</span></code> is equivalent to no annotation at all), but it does serve as a form of useful in-code documentation for the developer.</p>
<p>For the sake of generated documentation, the name of the alias gets lost (the <a class="reference external" href="https://docs.jax.dev/en/latest/_autosummary/jax.lax.slice.html">HTML docs</a> for <code class="docutils literal notranslate"><span class="pre">jax.lax.slice</span></code> report operand as type <code class="docutils literal notranslate"><span class="pre">Any</span></code>), so the documentation benefit does not go beyond the source code (though we could enable some <code class="docutils literal notranslate"><span class="pre">sphinx-autodoc</span></code> options to improve this: See <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/autodoc.html#confval-autodoc_type_aliases">autodoc_type_aliases</a>).</p>
<p>A benefit of this level of type annotation is that it is never wrong to annotate a value with <code class="docutils literal notranslate"><span class="pre">Any</span></code>, so it will provide a concrete benefit to developers and users in the form of documentation, without added complexity of satisfying the stricter needs of any particular static type checker.</p>
</section>
<section id="level-2-annotations-for-intelligent-autocomplete">
<h3>Level 2: Annotations for intelligent autocomplete<a class="headerlink" href="#level-2-annotations-for-intelligent-autocomplete" title="Link to this heading">#</a></h3>
<p>Many modern IDEs take advantage of type annotations as inputs to <a class="reference external" href="https://en.wikipedia.org/wiki/Intelligent_code_completion">intelligent code completion</a> systems. One example of this is the <a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=ms-python.vscode-pylance">Pylance</a> extension for VSCode, which uses Microsoft‚Äôs <a class="reference external" href="https://github.com/microsoft/pyright">pyright</a> static type checker as a source of information for VSCode‚Äôs <a class="reference external" href="https://code.visualstudio.com/docs/editor/intellisense">IntelliSense</a> completions.</p>
<p>This use of type checking requires going further than the simple aliases used above; for example, knowing that the <code class="docutils literal notranslate"><span class="pre">slice</span></code> function returns an alias of <code class="docutils literal notranslate"><span class="pre">Any</span></code> named <code class="docutils literal notranslate"><span class="pre">Array</span></code> does not add any useful information to the code completion engine. However, were we to annotate the function with a <code class="docutils literal notranslate"><span class="pre">DeviceArray</span></code> return type, the autocomplete would know how to populate the namespace of the result, and thus be able to suggest more relevant autocompletions during the course of development.</p>
<p>JAX has begun to add this level of type annotation in a few places; one example is the <code class="docutils literal notranslate"><span class="pre">jnp.ndarray</span></code> return type within the <code class="docutils literal notranslate"><span class="pre">jax.random</span></code> package [<a class="reference external" href="https://github.com/jax-ml/jax/blob/2bc3e39cd9104071ee39dacac22abd51b94eb27e/jax/_src/random.py#L359">source</a>]:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">shuffle</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>In this case <code class="docutils literal notranslate"><span class="pre">jnp.ndarray</span></code> is an abstract base class that forward-declares the attributes and methods of JAX arrays (<a class="reference external" href="https://github.com/jax-ml/jax/blob/2bc3e39cd9104071ee39dacac22abd51b94eb27e/jax/_src/numpy/ndarray.py#L41">see source</a>), and so Pylance in VSCode can offer the full set of autocompletions on results from this function. Here is a screenshot showing the result:</p>
<p><img alt="VSCode Intellisense Screenshot" src="../_images/vscode-completion.png" /></p>
<p>Listed in the autocomplete field are all methods and attributes declared by the abstract <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> class.
We‚Äôll discuss further below why it was necessary to create this abstract class rather than annotating with <code class="docutils literal notranslate"><span class="pre">DeviceArray</span></code> directly.</p>
</section>
<section id="level-3-annotations-for-static-type-checking">
<h3>Level 3: Annotations for static type-checking<a class="headerlink" href="#level-3-annotations-for-static-type-checking" title="Link to this heading">#</a></h3>
<p>These days, static type-checking often is the first thing people think of when considering the purpose of type annotations in Python code.
While Python does not do any runtime checking of types, several mature static type checking tools exist that can do this as part of a CI test suite.
The most important ones for JAX are the following:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/python/mypy">python/mypy</a> is more or less the standard in the open Python world. JAX currently runs mypy on a subset of source files within the Github Actions CI checks.</p></li>
<li><p><a class="reference external" href="https://github.com/google/pytype">google/pytype</a> is Google‚Äôs static type checker, and projects which depend on JAX within Google frequently use this.</p></li>
<li><p><a class="reference external" href="https://github.com/microsoft/pyright">microsoft/pyright</a> is important as the static type checker used within VSCode for the Pylance completions mentioned previously.</p></li>
</ul>
<p>Full static type checking is the strictest of all the type annotation applications, because it will surface an error any time your type annotations are not precisely correct.
On the one hand, this is nice because your static type analysis may catch faulty type annotations (for example, a case where a <code class="docutils literal notranslate"><span class="pre">DeviceArray</span></code> method is missing from the <code class="docutils literal notranslate"><span class="pre">jnp.ndarray</span></code> abstract class).</p>
<p>On the other hand, this strictness can make the type checking process very brittle in packages that often rely on duck-typing rather than strict type-safe APIs.
You‚Äôll currently find code comments like <code class="docutils literal notranslate"><span class="pre">#type:</span> <span class="pre">ignore</span></code> (for mypy) or <code class="docutils literal notranslate"><span class="pre">#pytype:</span> <span class="pre">disable</span></code> (for pytype) peppered throughout the JAX codebase in several hundred places.
These typically represent cases where typing problems have arisen; they may be inaccuracies in JAX type annotations, or inaccuracies in the static type checker‚Äôs ability to correctly follow the control flow in the code.
On occasion, they are due to real &amp; subtle bugs in the behavior of pytype or mypy.
In rare cases, they may be due to the fact that JAX uses Python patterns that are difficult or even impossible to express in terms of Python‚Äôs static type annotation syntax.</p>
</section>
</section>
<section id="type-annotation-challenges-for-jax">
<h2>Type annotation challenges for JAX<a class="headerlink" href="#type-annotation-challenges-for-jax" title="Link to this heading">#</a></h2>
<p>JAX currently has type annotations that are a mixture of different styles, and aimed at all three levels of type annotation discussed above.
Partly, this comes from the fact that JAX‚Äôs source code poses a number of unique challenges for Python‚Äôs type annotation system. We‚Äôll outline them here.</p>
<section id="challenge-1-pytype-mypy-and-developer-friction">
<h3>Challenge 1: pytype, mypy and developer friction<a class="headerlink" href="#challenge-1-pytype-mypy-and-developer-friction" title="Link to this heading">#</a></h3>
<p>One challenge JAX currently faces is that package development must satisfy the constraints of two different static type checking systems, <code class="docutils literal notranslate"><span class="pre">pytype</span></code> (used by internal CI and internal Google projects) and <code class="docutils literal notranslate"><span class="pre">mypy</span></code> (used by external CI and external dependencies).
Although the two type checkers have broad overlap in their behavior, each presents its own unique corner cases, as evidenced by the numerous <code class="docutils literal notranslate"><span class="pre">#type:</span> <span class="pre">ignore</span></code> and <code class="docutils literal notranslate"><span class="pre">#pytype:</span> <span class="pre">disable</span></code> statements throughout the JAX codebase.</p>
<p>This creates friction in development: internal contributors may iterate until tests pass, only to find that on export their pytype-approved code falls afoul of mypy.
For external contributors, it‚Äôs often the opposite: a recent example is <a class="reference external" href="https://github.com/jax-ml/jax/issues/9596">#9596</a> which had to be rolled-back after it failed internal Google pytype checks.
Each time we move a type annotation from Level 1 (<code class="docutils literal notranslate"><span class="pre">Any</span></code> everywhere) to Level 2 or 3 (stricter annotations), it introduces more potential for such frustrating developer experiences.</p>
</section>
<section id="challenge-2-array-duck-typing">
<h3>Challenge 2: array duck-typing<a class="headerlink" href="#challenge-2-array-duck-typing" title="Link to this heading">#</a></h3>
<p>One particular challenge for annotating JAX code is its heavy use of duck-typing. An input to a function marked <code class="docutils literal notranslate"><span class="pre">Array</span></code> in general could be one of many different types: a JAX <code class="docutils literal notranslate"><span class="pre">DeviceArray</span></code>, a NumPy <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code>, a NumPy scalar, a Python scalar, a Python sequence, an object with an <code class="docutils literal notranslate"><span class="pre">__array__</span></code> attribute, an object with a <code class="docutils literal notranslate"><span class="pre">__jax_array__</span></code> attribute, or any flavor of <code class="docutils literal notranslate"><span class="pre">jax.Tracer</span></code>.
For this reason, simple annotations like <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">func(x:</span> <span class="pre">DeviceArray)</span></code> will not be sufficient, and will lead to false positives for many valid uses.
This means that type annotations for JAX functions will not be short or trivial, but we would have to effectively develop a set of JAX-specific typing extensions similar to those in the <a class="reference external" href="https://github.com/numpy/numpy/blob/main/numpy/_typing/_array_like.py"><code class="docutils literal notranslate"><span class="pre">numpy.typing</span></code> package</a>.</p>
</section>
<section id="challenge-3-transformations-and-decorators">
<h3>Challenge 3: transformations and decorators<a class="headerlink" href="#challenge-3-transformations-and-decorators" title="Link to this heading">#</a></h3>
<p>JAX‚Äôs Python API relies heavily on function transformations (<a class="reference internal" href="../_autosummary/jax.jit.html#jax.jit" title="jax.jit"><code class="xref py py-func docutils literal notranslate"><span class="pre">jit()</span></code></a>, <a class="reference internal" href="../_autosummary/jax.vmap.html#jax.vmap" title="jax.vmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">vmap()</span></code></a>, <a class="reference internal" href="../_autosummary/jax.grad.html#jax.grad" title="jax.grad"><code class="xref py py-func docutils literal notranslate"><span class="pre">grad()</span></code></a>, etc.), and this type of API poses a particular challenge for static type analysis.
Flexible annotation for decorators has been a <a class="reference external" href="https://github.com/python/mypy/issues/1927">long-standing issue</a> in the mypy package, which was only recently resolved by the introduction of <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code>, discussed in <a class="reference external" href="https://peps.python.org/pep-0612/">PEP 612</a> and added in Python 3.10.
Because JAX follows <a class="reference external" href="https://numpy.org/neps/nep-0029-deprecation_policy.html">NEP 29</a>, it cannot rely on Python 3.10 features until sometime after mid-2024.
In the meantime, Protocols can be used as a partial solution to this (JAX added this for jit and other methods in <a class="reference external" href="https://github.com/jax-ml/jax/issues/9950">#9950</a>) and ParamSpec is possible to use via the <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> package (a prototype is in <a class="reference external" href="https://github.com/jax-ml/jax/issues/9999">#9999</a>) though this currently reveals fundamental bugs in mypy (see <a class="reference external" href="https://github.com/python/mypy/issues/12593">python/mypy#12593</a>).
All that to say: it‚Äôs not yet clear that the API of JAX‚Äôs function transforms can be suitably annotated within the current constraints of Python type annotation tools.</p>
</section>
<section id="challenge-4-array-annotation-lack-of-granularity">
<h3>Challenge 4: array annotation lack of granularity<a class="headerlink" href="#challenge-4-array-annotation-lack-of-granularity" title="Link to this heading">#</a></h3>
<p>Another challenge here is common to all array-oriented APIs in Python, and has been part of the JAX discussion for several years (see <a class="reference external" href="https://github.com/jax-ml/jax/issues/943">#943</a>).
Type annotations have to do with the Python class or type of an object, whereas in array-based languages often the attributes of the class are more important.
In the case of NumPy, JAX, and similar packages, often we would wish to annotate particular array shapes and data types.</p>
<p>For example, the arguments to the <code class="docutils literal notranslate"><span class="pre">jnp.linspace</span></code> function must be scalar values, but in JAX scalars are represented by zero-dimensional arrays.
So in order for annotations to not raise false positives, we must allow these arguments to be <em>arbitrary</em> arrays.
Another example is the second argument to <code class="docutils literal notranslate"><span class="pre">jax.random.choice</span></code>, which must have <code class="docutils literal notranslate"><span class="pre">dtype=int</span></code> when <code class="docutils literal notranslate"><span class="pre">shape=()</span></code>.
Python has a plan to enable type annotations with this level of granularity via Variadic Type Generics (see <a class="reference external" href="https://peps.python.org/pep-0646/">PEP 646</a>, slated for Python 3.11) but like <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code>, support for this feature will take a while to stabilize.</p>
<p>There are some third-party projects that may help in the meantime, in particular <a class="reference external" href="https://github.com/google/jaxtyping">google/jaxtyping</a>, but this uses non-standard annotations and may not be suitable for annotating the core JAX library itself.
All told, the array-type-granularity challenge is less of an issue than the other challenges, because the main effect is that array-like annotations will be less specific than they otherwise could be.</p>
</section>
<section id="challenge-5-imprecise-apis-inherited-from-numpy">
<h3>Challenge 5: imprecise APIs inherited from NumPy<a class="headerlink" href="#challenge-5-imprecise-apis-inherited-from-numpy" title="Link to this heading">#</a></h3>
<p>A large part of JAX‚Äôs user-facing API is inherited from NumPy within the <a class="reference internal" href="../jax.numpy.html#module-jax.numpy" title="jax.numpy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jax.numpy</span></code></a> submodule.
NumPy‚Äôs API was developed years before static type checking became part of the Python language, and follows Python‚Äôs historic recommendations to use a <a class="reference external" href="https://docs.python.org/3/glossary.html#term-duck-typing">duck-typing</a>/<a class="reference external" href="https://docs.python.org/3/glossary.html#term-EAFP">EAFP</a> coding style, in which strict type-checking at runtime is discouraged. As a concrete example of this, consider the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.tile.html#numpy.tile" title="(in NumPy v2.3)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.tile()</span></code></a> function, which is defined like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tile</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">reps</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">tup</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">reps</span><span class="p">)</span>
  <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
    <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">reps</span><span class="p">,)</span>
  <span class="n">d</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Here the <em>intent</em> is that <code class="docutils literal notranslate"><span class="pre">reps</span></code> would contain either an <code class="docutils literal notranslate"><span class="pre">int</span></code> or a sequence of <code class="docutils literal notranslate"><span class="pre">int</span></code> values, but the <em>implementation</em> allows <code class="docutils literal notranslate"><span class="pre">tup</span></code> to be any iterable.
When adding annotations to this kind of duck-typed code, we could take one of two routes:</p>
<ol class="arabic simple">
<li><p>We may choose to annotate the <em>intent</em> of the function‚Äôs API, which here might be something like <code class="docutils literal notranslate"><span class="pre">reps:</span> <span class="pre">Union[int,</span> <span class="pre">Sequence[int]]</span></code>.</p></li>
<li><p>Conversely, we may choose to annotate the <em>implementation</em> of the function, which here might look something like <code class="docutils literal notranslate"><span class="pre">reps:</span> <span class="pre">Union[ConvertibleToInt,</span> <span class="pre">Iterable[ConvertibleToInt]]</span></code> where <code class="docutils literal notranslate"><span class="pre">ConvertibleToInt</span></code> is a special protocol that covers the exact mechanism by which our function converts the inputs to integers (i.e. via <code class="docutils literal notranslate"><span class="pre">__int__</span></code>, via <code class="docutils literal notranslate"><span class="pre">__index__</span></code>, via <code class="docutils literal notranslate"><span class="pre">__array__</span></code>, etc.). Note also here that in a strict sense, <code class="docutils literal notranslate"><span class="pre">Iterable</span></code> is not sufficient here because there are objects in Python that duck-type as iterables but do not satisfy a static type check against <code class="docutils literal notranslate"><span class="pre">Iterable</span></code> (namely, an object that is iterable via <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> rather than <code class="docutils literal notranslate"><span class="pre">__iter__</span></code>.)</p></li>
</ol>
<p>The advantage of #1, annotating intent, is that the annotations are more useful to the user in communicating the API contract; while for the developer the flexibility leaves room for refactoring when necessary. The down-side (particularly for gradually-typed APIs like JAX‚Äôs) is that it‚Äôs quite likely that user code exists which runs correctly, but would be flagged as incorrect by a type checker.
Gradual typing of an existing duck-typed API means that the current annotation is implicitly <code class="docutils literal notranslate"><span class="pre">Any</span></code>, so changing this to a stricter type may present to users as a breaking change.</p>
<p>Broadly speaking, annotating intent better serves Level 1 type checking, while annotating implementation better serves Level 3, while Level 2 is more of a mixed bag (both intent and implementation are important when it comes to annotations in IDEs).</p>
</section>
</section>
<section id="jax-type-annotation-roadmap">
<h2>JAX type annotation roadmap<a class="headerlink" href="#jax-type-annotation-roadmap" title="Link to this heading">#</a></h2>
<p>With this framing (Level 1/2/3) and JAX-specific challenges in mind, we can begin to develop our roadmap for implementing consistent type annotations across the JAX project.</p>
<section id="guiding-principles">
<h3>Guiding Principles<a class="headerlink" href="#guiding-principles" title="Link to this heading">#</a></h3>
<p>For JAX type annotation, we will be guided by the following principles:</p>
<section id="purpose-of-type-annotations">
<h4>Purpose of type annotations<a class="headerlink" href="#purpose-of-type-annotations" title="Link to this heading">#</a></h4>
<p>We would like to support full, <em>Level 1, 2, and 3</em> type annotation as far as possible. In particular, this means that we should have restrictive type annotations on both inputs and outputs to public API functions.</p>
</section>
<section id="annotate-for-intent">
<h4>Annotate for intent<a class="headerlink" href="#annotate-for-intent" title="Link to this heading">#</a></h4>
<p>JAX type annotations should in general indicate the <strong>intent</strong> of APIs, rather than the implementation, so that the annotations become useful to communicate the contract of the API. This means that at times inputs that are valid at runtime may not be recognized as valid by the static type checker (one example might be an arbitrary iterator passed in place of a shape that is annotated as <code class="docutils literal notranslate"><span class="pre">Shape</span> <span class="pre">=</span> <span class="pre">Sequence[int]</span></code>).</p>
</section>
<section id="inputs-should-be-permissively-typed">
<h4>Inputs should be permissively-typed<a class="headerlink" href="#inputs-should-be-permissively-typed" title="Link to this heading">#</a></h4>
<p>Inputs to JAX functions and methods should be typed as permissively as is reasonable: for example, while shapes are typically tuples, functions that accept a shape should accept arbitrary sequences. Similarly, functions that accept a dtype need not require an instance of class <code class="docutils literal notranslate"><span class="pre">np.dtype</span></code>, but rather any dtype-convertible object. This might include strings, built-in scalar types, or scalar object constructors such as <code class="docutils literal notranslate"><span class="pre">np.float64</span></code> and <code class="docutils literal notranslate"><span class="pre">jnp.float64</span></code>. In order to make this as uniform as possible across the package, we will add a <a class="reference internal" href="../jax.typing.html#module-jax.typing" title="jax.typing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jax.typing</span></code></a> module with common type specifications, starting with broad categories such as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ArrayLike</span></code> would be a union of anything that can be implicitly converted into an array: for example, jax arrays, numpy arrays, JAX tracers, and python or numpy scalars</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DTypeLike</span></code> would be a union of anything that can be implicitly converted into a dtype: for example, numpy dtypes, numpy dtype objects, jax dtype objects, strings, and built-in types.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ShapeLike</span></code> would be a union of anything that could be converted into a shape: for example, sequences of integer or integer-like objects.</p></li>
<li><p>etc.</p></li>
</ul>
<p>Note that these will in general be simpler than the equivalent protocols used in <a class="reference external" href="https://numpy.org/doc/stable/reference/typing.html#module-numpy.typing" title="(in NumPy v2.3)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy.typing</span></code></a>. For example, in the case of <code class="docutils literal notranslate"><span class="pre">DTypeLike</span></code>, JAX does not support structured dtypes, so JAX can use a simpler implementation. Similarly, in <code class="docutils literal notranslate"><span class="pre">ArrayLike</span></code>, JAX generally does not support list or tuple inputs in place of arrays, so the type definition will be simpler than the NumPy analog.</p>
</section>
<section id="outputs-should-be-strictly-typed">
<h4>Outputs should be strictly-typed<a class="headerlink" href="#outputs-should-be-strictly-typed" title="Link to this heading">#</a></h4>
<p>Conversely, outputs of functions and methods should be typed as strictly as possible: for example, for a JAX function that returns an array, the output should be annotated with something similar to <code class="docutils literal notranslate"><span class="pre">jnp.ndarray</span></code> rather than <code class="docutils literal notranslate"><span class="pre">ArrayLike</span></code>. Functions returning a dtype should always be annotated <code class="docutils literal notranslate"><span class="pre">np.dtype</span></code>, and functions returning a shape should always be <code class="docutils literal notranslate"><span class="pre">Tuple[int]</span></code> or a strictly-typed NamedShape equivalent. For this purpose, we will implement in <a class="reference internal" href="../jax.typing.html#module-jax.typing" title="jax.typing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jax.typing</span></code></a> several strictly-typed analogs of the permissive types mentioned above, namely:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Array</span></code> or <code class="docutils literal notranslate"><span class="pre">NDArray</span></code> (see below) for type annotation purposes is effectively equivalent to <code class="docutils literal notranslate"><span class="pre">Union[Tracer,</span> <span class="pre">jnp.ndarray]</span></code> and should be used to annotate array outputs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DType</span></code> is an alias of <code class="docutils literal notranslate"><span class="pre">np.dtype</span></code>, perhaps with the ability to also represent key types and other generalizations used within JAX.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Shape</span></code> is essentially <code class="docutils literal notranslate"><span class="pre">Tuple[int,</span> <span class="pre">...]</span></code>, perhaps with some additional flexibility to account for dynamic shapes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NamedShape</span></code> is an extension of <code class="docutils literal notranslate"><span class="pre">Shape</span></code> that allows for named shapes as used internally in JAX.</p></li>
<li><p>etc.</p></li>
</ul>
<p>We will also explore whether the current implementation of <code class="docutils literal notranslate"><span class="pre">jax.numpy.ndarray</span></code> can be dropped in favor of making <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> an alias of <code class="docutils literal notranslate"><span class="pre">Array</span></code> or similar.</p>
</section>
<section id="err-toward-simplicity">
<h4>Err toward simplicity<a class="headerlink" href="#err-toward-simplicity" title="Link to this heading">#</a></h4>
<p>Aside from common typing protocols gathered in <code class="docutils literal notranslate"><span class="pre">jax.typing</span></code>, we should err on the side of simplicity. We should avoid constructing overly-complex protocols for arguments passed to API functions, and instead use simple unions such as <code class="docutils literal notranslate"><span class="pre">Union[simple_type,</span> <span class="pre">Any]</span></code> in the case that the full type specification of the API cannot be succinctly specified. This is a compromise that achieves the goals of Level 1 and 2 annotations, while punting on Level 3 in favor of avoiding unnecessary complexity.</p>
</section>
<section id="avoid-unstable-typing-mechanisms">
<h4>Avoid unstable typing mechanisms<a class="headerlink" href="#avoid-unstable-typing-mechanisms" title="Link to this heading">#</a></h4>
<p>In order to not add undue development friction (due to the internal/external CI differences), we would like to be conservative in the type annotation constructs we use: in particular, when it comes to recently-introduced mechanisms such as <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> (<a class="reference external" href="https://peps.python.org/pep-0612/">PEP 612</a>) and Variadic Type Generics (<a class="reference external" href="https://peps.python.org/pep-0646/">PEP 646</a>), we would like to wait until support in mypy and other tools matures and stabilizes before relying on them.</p>
<p>One impact of this is that for the time being, when functions are decorated by JAX transformations like <code class="docutils literal notranslate"><span class="pre">jit</span></code>, <code class="docutils literal notranslate"><span class="pre">vmap</span></code>, <code class="docutils literal notranslate"><span class="pre">grad</span></code>, etc. JAX will effectively <strong>strip all annotations</strong> from the decorated function.
While this is unfortunate, at the time of this writing mypy has a laundry-list of incompatibilities with the potential solution offered by <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> (see <a class="reference external" href="https://github.com/python/mypy/issues?q=is%3Aissue+is%3Aopen++label%3Atopic-paramspec+"><code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> mypy bug tracker</a>), and we therefore judge it as not ready for full adoption in JAX at this time.
We will revisit this question in the future once support for such features stabilizes.</p>
<p>Similarly, for the time being we will avoid adding the more complex &amp; granular array type annotations offered by the <a class="reference external" href="http://github.com/google/jaxtyping">jaxtyping</a> project. This is a decision we could revisit at a future date.</p>
</section>
</section>
<section id="array-type-design-considerations">
<h3><code class="docutils literal notranslate"><span class="pre">Array</span></code> Type Design Considerations<a class="headerlink" href="#array-type-design-considerations" title="Link to this heading">#</a></h3>
<p>As mentioned above, type annotation of arrays in JAX poses a unique challenge because of JAX‚Äôs extensive use of duck-typing, i.e. passing and returning <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> objects in place actual arrays within jax transformations.
This becomes increasingly confusing because objects used for type annotation often overlap with objects used for runtime instance checking, and may or may not correspond to the actual type hierarchy of the objects in question.
For JAX, we need to provide duck-typed objects for use in two contexts: <strong>static type annotations</strong> and <strong>runtime instance checks</strong>.</p>
<p>The following discussion will assume that <code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is the runtime type on-device arrays, which is not yet the case but will be once the work in <a class="reference external" href="https://github.com/jax-ml/jax/issues/12016">#12016</a> is complete.</p>
<section id="static-type-annotations">
<h4>Static type annotations<a class="headerlink" href="#static-type-annotations" title="Link to this heading">#</a></h4>
<p>We need to provide an object that can be used for duck-typed type annotations.
Assuming for the moment that we call this object <code class="docutils literal notranslate"><span class="pre">ArrayAnnotation</span></code>, we need a solution which satisfies <code class="docutils literal notranslate"><span class="pre">mypy</span></code> and <code class="docutils literal notranslate"><span class="pre">pytype</span></code> for a case like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">ArrayAnnotation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayAnnotation</span><span class="p">:</span>
  <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Tracer</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>This could be accomplished via a number of approaches, for example:</p>
<ul class="simple">
<li><p>Use a type union: <code class="docutils literal notranslate"><span class="pre">ArrayAnnotation</span> <span class="pre">=</span> <span class="pre">Union[Array,</span> <span class="pre">Tracer]</span></code></p></li>
<li><p>Create an interface file that declares <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> and <code class="docutils literal notranslate"><span class="pre">Array</span></code> should be treated as subclasses of <code class="docutils literal notranslate"><span class="pre">ArrayAnnotation</span></code>.</p></li>
<li><p>Restructure <code class="docutils literal notranslate"><span class="pre">Array</span></code> and <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> so that <code class="docutils literal notranslate"><span class="pre">ArrayAnnotation</span></code> is a true base class of both.</p></li>
</ul>
</section>
<section id="runtime-instance-checks">
<h4>Runtime instance checks<a class="headerlink" href="#runtime-instance-checks" title="Link to this heading">#</a></h4>
<p>We also must provide an object that can be used for duck-typed runtime <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> checks.
Assuming for the moment that we call this object <code class="docutils literal notranslate"><span class="pre">ArrayInstance</span></code>, we need a solution that passes the following runtime check:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ArrayInstance</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>       <span class="c1"># x will be an array</span>
<span class="k">assert</span> <span class="n">jit</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># x will be a tracer</span>
</pre></div>
</div>
<p>Again, there are a couple mechanisms that could be used for this:</p>
<ul class="simple">
<li><p>override <code class="docutils literal notranslate"><span class="pre">type(ArrayInstance).__instancecheck__</span></code> to return <code class="docutils literal notranslate"><span class="pre">True</span></code> for both <code class="docutils literal notranslate"><span class="pre">Array</span></code> and <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> objects; this is how <code class="docutils literal notranslate"><span class="pre">jnp.ndarray</span></code> is currently implemented (<a class="reference external" href="https://github.com/jax-ml/jax/blob/jax-v0.3.17/jax/_src/numpy/ndarray.py#L24-L49">source</a>).</p></li>
<li><p>define <code class="docutils literal notranslate"><span class="pre">ArrayInstance</span></code> as an abstract base class and dynamically register it to <code class="docutils literal notranslate"><span class="pre">Array</span></code> and <code class="docutils literal notranslate"><span class="pre">Tracer</span></code></p></li>
<li><p>restructure <code class="docutils literal notranslate"><span class="pre">Array</span></code> and <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> so that <code class="docutils literal notranslate"><span class="pre">ArrayInstance</span></code> is a true base class of both <code class="docutils literal notranslate"><span class="pre">Array</span></code> and <code class="docutils literal notranslate"><span class="pre">Tracer</span></code></p></li>
</ul>
<p>A decision we need to make is whether <code class="docutils literal notranslate"><span class="pre">ArrayAnnotation</span></code> and <code class="docutils literal notranslate"><span class="pre">ArrayInstance</span></code> should be the same or different objects. There is some precedent here; for example in the core Python language spec, <code class="docutils literal notranslate"><span class="pre">typing.Dict</span></code> and <code class="docutils literal notranslate"><span class="pre">typing.List</span></code> exist for the sake of annotation, while the built-in <code class="docutils literal notranslate"><span class="pre">dict</span></code> and <code class="docutils literal notranslate"><span class="pre">list</span></code> serve the purposes of instance checks.
However, <code class="docutils literal notranslate"><span class="pre">Dict</span></code> and <code class="docutils literal notranslate"><span class="pre">List</span></code> are <a class="reference external" href="https://peps.python.org/pep-0585/#implementation">deprecated</a> in newer Python versions in favor of using <code class="docutils literal notranslate"><span class="pre">dict</span></code> and <code class="docutils literal notranslate"><span class="pre">list</span></code> for both annotation and instance checks.</p>
</section>
<section id="following-numpy-s-lead">
<h4>Following NumPy‚Äôs lead<a class="headerlink" href="#following-numpy-s-lead" title="Link to this heading">#</a></h4>
<p>In NumPy‚Äôs case, <code class="docutils literal notranslate"><span class="pre">np.typing.NDArray</span></code> serves the purpose of type annotations, while <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> serves the purpose of instance checks (as well as array type identity).
Given this, it may be reasonable to conform to NumPy‚Äôs precedent and implement the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is the actual type of on-device arrays.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.typing.NDArray</span></code> is the object used for duck-typed array annotations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.numpy.ndarray</span></code> is the object used for duck-typed array instance checks.</p></li>
</ul>
<p>This might feel somewhat natural to NumPy power-users, however this trifurcation would likely be a source of confusion: the choice of which to use for instance checks and annotations is not immediately clear.</p>
</section>
<section id="unifying-instance-checks-and-annotation">
<h4>Unifying instance checks and annotation<a class="headerlink" href="#unifying-instance-checks-and-annotation" title="Link to this heading">#</a></h4>
<p>Another approach would be to unify type checking and annotation via override mechanisms mentioned above.</p>
<section id="option-1-partial-unification">
<h5>Option 1: Partial unification<a class="headerlink" href="#option-1-partial-unification" title="Link to this heading">#</a></h5>
<p>A partial unification might look like this:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is the actual type of on-device arrays.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.typing.Array</span></code> is the object used for duck-typed array annotations (via <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> interfaces on <code class="docutils literal notranslate"><span class="pre">Array</span></code> and <code class="docutils literal notranslate"><span class="pre">Tracer</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.typing.Array</span></code> is also the object used duck-typed instance checks (via an <code class="docutils literal notranslate"><span class="pre">__isinstance__</span></code> override in its metaclass)</p></li>
</ul>
<p>In this approach, <code class="docutils literal notranslate"><span class="pre">jax.numpy.ndarray</span></code> would become a simple alias <code class="docutils literal notranslate"><span class="pre">jax.typing.Array</span></code> for backward compatibility.</p>
</section>
<section id="option-2-full-unification-via-overrides">
<h5>Option 2: Full unification via overrides<a class="headerlink" href="#option-2-full-unification-via-overrides" title="Link to this heading">#</a></h5>
<p>Alternatively, we could opt for full unification via overrides:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is the actual type of on-device arrays.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is also the object used for duck-typed array annotations (via a <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> interface on <code class="docutils literal notranslate"><span class="pre">Tracer</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is also the object used for duck-typed instance checks (via an <code class="docutils literal notranslate"><span class="pre">__isinstance__</span></code> override in its metaclass)</p></li>
</ul>
<p>Here, <code class="docutils literal notranslate"><span class="pre">jax.numpy.ndarray</span></code> would become a simple alias <code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> for backward compatibility.</p>
</section>
<section id="option-3-full-unification-via-class-hierarchy">
<h5>Option 3: Full unification via class hierarchy<a class="headerlink" href="#option-3-full-unification-via-class-hierarchy" title="Link to this heading">#</a></h5>
<p>Finally, we could opt for full unification via restructuring of the class hierarchy and replacing duck-typing with OOP object hierarchies:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is the actual type of on-device arrays</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is also the object used for array type annotations, by ensuring that <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">jax.Array</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is also the object used for instance checks, via the same mechanism</p></li>
</ul>
<p>Here <code class="docutils literal notranslate"><span class="pre">jnp.ndarray</span></code> could be an alias for <code class="docutils literal notranslate"><span class="pre">jax.Array</span></code>.
This final approach is in some senses the most pure, but it is somewhat forced from an OOP design standpoint (<code class="docutils literal notranslate"><span class="pre">Tracer</span></code> <em>is an</em> <code class="docutils literal notranslate"><span class="pre">Array</span></code>?).</p>
</section>
<section id="option-4-partial-unification-via-class-hierarchy">
<h5>Option 4: Partial unification via class hierarchy<a class="headerlink" href="#option-4-partial-unification-via-class-hierarchy" title="Link to this heading">#</a></h5>
<p>We could make the class hierarchy more sensible by making <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> and the class for
on-device arrays inherit from a common base class. So, for example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is a base class for <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> as well as the actual type of on-device arrays,
which might be <code class="docutils literal notranslate"><span class="pre">jax._src.ArrayImpl</span></code> or similar.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is the object used for array type annotations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is also the object used for instance checks</p></li>
</ul>
<p>Here <code class="docutils literal notranslate"><span class="pre">jnp.ndarray</span></code> would be an alias for <code class="docutils literal notranslate"><span class="pre">Array</span></code>.
This may be purer from an OOP perspective, but compared to Options 2 and 3 it drops the notion
that <code class="docutils literal notranslate"><span class="pre">type(x)</span> <span class="pre">is</span> <span class="pre">jax.Array</span></code> will evaluate to True.</p>
</section>
<section id="evaluation">
<h5>Evaluation<a class="headerlink" href="#evaluation" title="Link to this heading">#</a></h5>
<p>Considering the overall strengths and weaknesses of each potential approach:</p>
<ul class="simple">
<li><p>From a user perspective, the unified approaches (options 2 and 3) are arguably best, because they remove the cognitive overhead involved in remembering which objects to use for instance checks or annotations: <code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> is all you need to know.</p></li>
<li><p>However, both options 2 and 3 introduce some strange and/or confusing behavior. Option 2 depends on potentially confusing overrides of instance checks, which are <a class="reference external" href="https://github.com/pybind/pybind11/issues/2696">not well supported</a> for classes defined in pybind11. Option 3 requires <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> to be a subclass array. This breaks the inheritance model, because it would require <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> objects to carry all the baggage of <code class="docutils literal notranslate"><span class="pre">Array</span></code> objects (data buffers, sharding, devices, etc.)</p></li>
<li><p>Option 4 is purer in an OOP sense, and avoids the need for any overrides of typical instance check or type annotation behavior. The tradeoff is that the actual type of on-device arrays becomes something separate (here <code class="docutils literal notranslate"><span class="pre">jax._src.ArrayImpl</span></code>). But the vast majority of users would never have to touch this private implementation directly.</p></li>
</ul>
<p>There are different tradeoffs here, but after discussion we‚Äôve landed on Option 4 as our way forward.</p>
</section>
</section>
</section>
<section id="implementation-plan">
<h3>Implementation Plan<a class="headerlink" href="#implementation-plan" title="Link to this heading">#</a></h3>
<p>To move forward with type annotations, we will do the following:</p>
<ol class="arabic">
<li><p>Iterate on this JEP doc until developers and stakeholders are bought-in.</p></li>
<li><p>Create a private <code class="docutils literal notranslate"><span class="pre">jax._src.typing</span></code> (not providing any public APIs for now) and put in it the first level of simple types mentioned above:</p>
<ul class="simple">
<li><p>Alias <code class="docutils literal notranslate"><span class="pre">Array</span> <span class="pre">=</span> <span class="pre">Any</span></code> for the time being, as this will take a bit more thought.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArrayLike</span></code>: a Union of types valid as inputs to normal <code class="docutils literal notranslate"><span class="pre">jax.numpy</span></code> functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DType</span></code> / <code class="docutils literal notranslate"><span class="pre">DTypeLike</span></code> (Note: numpy uses camel-cased <code class="docutils literal notranslate"><span class="pre">DType</span></code>; we should follow this convention for ease of use)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Shape</span></code> / <code class="docutils literal notranslate"><span class="pre">NamedShape</span></code> / <code class="docutils literal notranslate"><span class="pre">ShapeLike</span></code></p></li>
</ul>
<p>The beginnings of this are done in <a class="reference external" href="https://github.com/jax-ml/jax/issues/12300">#12300</a>.</p>
</li>
<li><p>Begin work on a <code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> base class that follows Option 4 from the previous section. Initially this will be defined in Python, and use the dynamic registration mechanism currently found in the <code class="docutils literal notranslate"><span class="pre">jnp.ndarray</span></code> implementation to ensure correct behavior of <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> checks. A <code class="docutils literal notranslate"><span class="pre">pyi</span></code> override for each tracer and array-like class would ensure correct behavior for type annotations. <code class="docutils literal notranslate"><span class="pre">jnp.ndarray</span></code> could then be make into an alias of <code class="docutils literal notranslate"><span class="pre">jax.Array</span></code></p></li>
<li><p>As a test, use these new typing definitions to comprehensively annotate functions within <code class="docutils literal notranslate"><span class="pre">jax.lax</span></code> according to the guidelines above.</p></li>
<li><p>Continue adding additional annotations one module at a time, focusing on public API functions.</p></li>
<li><p>In parallel, begin re-implementing a <code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> base class in pybind11, so that <code class="docutils literal notranslate"><span class="pre">ArrayImpl</span></code> and <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> can inherit from it. Use a <code class="docutils literal notranslate"><span class="pre">pyi</span></code> definition to ensure static type checkers recognize the appropriate attributes of the class.</p></li>
<li><p>Once <code class="docutils literal notranslate"><span class="pre">jax.Array</span></code> and <code class="docutils literal notranslate"><span class="pre">jax._src.ArrayImpl</span></code> have fully landed, remove these temporary Python implementations.</p></li>
<li><p>When all is finalized, create a public <code class="docutils literal notranslate"><span class="pre">jax.typing</span></code> module that makes the above types available to users, along with documentation of annotation best practices for code using JAX.</p></li>
</ol>
<p>We will track this work in <a class="reference external" href="https://github.com/jax-ml/jax/issues/12049">#12049</a>, from which this JEP gets its number.</p>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="11830-new-remat-checkpoint.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><code class="docutils literal notranslate"><span class="pre">jax.remat</span></code> / <code class="docutils literal notranslate"><span class="pre">jax.checkpoint</span></code> changes: what you need to know</p>
      </div>
    </a>
    <a class="right-next"
       href="14273-shard-map.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><code class="docutils literal notranslate"><span class="pre">shmap</span></code> (<code class="docutils literal notranslate"><span class="pre">shard_map</span></code>) for simple per-device code</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-type-annotations">Why type annotations?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#level-1-annotations-as-documentation">Level 1: Annotations as documentation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#level-2-annotations-for-intelligent-autocomplete">Level 2: Annotations for intelligent autocomplete</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#level-3-annotations-for-static-type-checking">Level 3: Annotations for static type-checking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-annotation-challenges-for-jax">Type annotation challenges for JAX</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-1-pytype-mypy-and-developer-friction">Challenge 1: pytype, mypy and developer friction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-2-array-duck-typing">Challenge 2: array duck-typing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-3-transformations-and-decorators">Challenge 3: transformations and decorators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-4-array-annotation-lack-of-granularity">Challenge 4: array annotation lack of granularity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge-5-imprecise-apis-inherited-from-numpy">Challenge 5: imprecise APIs inherited from NumPy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jax-type-annotation-roadmap">JAX type annotation roadmap</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#guiding-principles">Guiding Principles</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose-of-type-annotations">Purpose of type annotations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#annotate-for-intent">Annotate for intent</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs-should-be-permissively-typed">Inputs should be permissively-typed</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs-should-be-strictly-typed">Outputs should be strictly-typed</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#err-toward-simplicity">Err toward simplicity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#avoid-unstable-typing-mechanisms">Avoid unstable typing mechanisms</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#array-type-design-considerations"><code class="docutils literal notranslate"><span class="pre">Array</span></code> Type Design Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#static-type-annotations">Static type annotations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-instance-checks">Runtime instance checks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#following-numpy-s-lead">Following NumPy‚Äôs lead</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unifying-instance-checks-and-annotation">Unifying instance checks and annotation</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#option-1-partial-unification">Option 1: Partial unification</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#option-2-full-unification-via-overrides">Option 2: Full unification via overrides</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#option-3-full-unification-via-class-hierarchy">Option 3: Full unification via class hierarchy</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#option-4-partial-unification-via-class-hierarchy">Option 4: Partial unification via class hierarchy</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation">Evaluation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-plan">Implementation Plan</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The JAX authors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024, The JAX Authors.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>